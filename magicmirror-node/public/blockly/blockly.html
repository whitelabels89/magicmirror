<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Programming for Kids</title>
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
    <script src="https://unpkg.com/blockly/msg/en.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        .editor-panel {
            width: 60%;
            background: #ffffff;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            position: relative;
        }

        .stage-panel {
            width: 40%;
            background: linear-gradient(45deg, #87CEEB, #98FB98);
            position: relative;
            overflow: hidden;
        }

        .controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }

        .control-btn {
            padding: 12px 20px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .run-btn {
            background: #4CAF50;
            color: white;
        }

        .run-btn:hover {
            background: #45a049;
            transform: scale(1.05);
        }

        .reset-btn {
            background: #FF6B6B;
            color: white;
        }

        .reset-btn:hover {
            background: #ff5252;
            transform: scale(1.05);
        }

        .demo-btn {
            background: #9C27B0;
            color: white;
        }

        .demo-btn:hover {
            background: #7B1FA2;
            transform: scale(1.05);
        }

        .help-btn:hover {
            background: #1976D2;
            transform: scale(1.05);
        }

        .help-panel {
            position: absolute;
            top: 60px;
            right: 10px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            max-width: 280px;
            font-size: 12px;
            z-index: 1001;
            display: none;
            border: 2px solid #2196F3;
        }

        .help-panel.show {
            display: block;
        }

        .help-panel h4 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 14px;
        }

        .help-panel ul {
            margin: 0;
            padding-left: 15px;
        }

        .help-panel li {
            margin: 5px 0;
            color: #666;
        }

        .help-close {
            position: absolute;
            top: 5px;
            right: 10px;
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            color: #999;
        }

        .stage {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }

        .character {
            position: absolute;
            width: 80px;
            height: 80px;
            bottom: 100px;
            left: 50px;
            transition: all 0.5s ease;
            cursor: pointer;
        }

        .character-body {
            width: 100%;
            height: 100%;
            background: #FFD700;
            border-radius: 50%;
            position: relative;
            border: 3px solid #FFA500;
        }

        .character-eyes {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
        }

        .eye {
            width: 12px;
            height: 12px;
            background: #000;
            border-radius: 50%;
        }

        .character-mouth {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 10px;
            border: 2px solid #000;
            border-top: none;
            border-radius: 0 0 20px 20px;
        }

        .speech-bubble {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 10px 15px;
            border-radius: 20px;
            border: 2px solid #333;
            font-size: 14px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 10;
        }

        .speech-bubble::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-top-color: white;
        }

        .speech-bubble.show {
            opacity: 1;
        }

        .blocklyTreeRow {
            height: 22px;
            line-height: 22px;
            margin-bottom: 3px;
            padding-left: 8px;
            white-space: nowrap;
        }

        .stage-title {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 24px;
            font-weight: bold;
            color: #333;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8);
        }

        .ground {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 80px;
            background: #90EE90;
            border-top: 3px solid #228B22;
        }

        .clouds {
            position: absolute;
            top: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .cloud {
            position: absolute;
            background: white;
            border-radius: 50px;
            opacity: 0.8;
        }

        .cloud:before, .cloud:after {
            content: '';
            position: absolute;
            background: white;
            border-radius: 50px;
        }

        .cloud1 {
            width: 60px;
            height: 30px;
            top: 50px;
            left: 20%;
        }

        .cloud1:before {
            width: 40px;
            height: 40px;
            top: -20px;
            left: 10px;
        }

        .cloud1:after {
            width: 30px;
            height: 30px;
            top: -15px;
            right: 10px;
        }

        .cloud2 {
            width: 80px;
            height: 40px;
            top: 80px;
            right: 20%;
        }

        .cloud2:before {
            width: 50px;
            height: 50px;
            top: -25px;
            left: 15px;
        }

        .cloud2:after {
            width: 40px;
            height: 40px;
            top: -20px;
            right: 15px;
        }

        @keyframes jump {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-30px); }
        }

        .jumping {
            animation: jump 0.6s ease-in-out;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        @keyframes wave {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-15deg); }
            75% { transform: rotate(15deg); }
        }

        @keyframes fall {
            0% { 
                transform: translateY(-100px); 
                opacity: 1; 
            }
            100% { 
                transform: translateY(400px); 
                opacity: 0; 
            }
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .editor-panel {
                width: 100%;
                height: 60%;
            }
            
            .stage-panel {
                width: 100%;
                height: 40%;
            }
            
            .controls {
                top: 5px;
                right: 5px;
            }
            
            .control-btn {
                padding: 8px 16px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="editor-panel">
            <div id="blocklyDiv" style="height: 100%; width: 100%;"></div>
        </div>
        
        <div class="stage-panel">
            <div class="controls">
                <button class="control-btn run-btn" onclick="runProgram()">‚ñ∂ Run</button>
                <button class="control-btn reset-btn" onclick="resetCharacter()">üîÑ Reset</button>
                <button class="control-btn demo-btn" onclick="loadSampleProgram()">üìö Contoh</button>
                <button class="control-btn help-btn" onclick="toggleHelp()" style="background: #2196F3; color: white;">‚ùì Bantuan</button>
            </div>
            
            <div class="help-panel" id="helpPanel">
                <button class="help-close" onclick="toggleHelp()">√ó</button>
                <h4>üìã Cara Menggunakan:</h4>
                <ul>
                    <li>Seret blok dari kategori di sebelah kiri</li>
                    <li>Sambungkan blok dari atas ke bawah</li>
                    <li>Blok pertama biasanya dari kategori "Tampilan" atau "Gerakan"</li>
                    <li>Tekan "Run" untuk menjalankan program</li>
                    <li>Tekan "Reset" untuk mengembalikan karakter</li>
                    <li>Tekan "Contoh" untuk melihat program sampel</li>
                </ul>
                <h4>üéØ Tips Susunan:</h4>
                <ul>
                    <li>Mulai dengan blok "üí¨ Bilang Halo"</li>
                    <li>Tambahkan "‚û°Ô∏è Gerak Kanan"</li>
                    <li>Lalu "ü§∏ Lompat"</li>
                    <li>Akhiri dengan "üé® Ganti Warna"</li>
                </ul>
            </div>
            
            <div class="stage-title">üé≠ Stage</div>
            
            <div class="stage">
                <div class="clouds">
                    <div class="cloud cloud1"></div>
                    <div class="cloud cloud2"></div>
                </div>
                
                <div class="character" id="character">
                    <div class="character-body">
                        <div class="character-eyes">
                            <div class="eye"></div>
                            <div class="eye"></div>
                        </div>
                        <div class="character-mouth"></div>
                    </div>
                    <div class="speech-bubble" id="speechBubble">Hello!</div>
                </div>
                
                <div class="ground"></div>
            </div>
        </div>
    </div>

    <script>
        // Character state
        let characterState = {
            x: 50,
            y: 100,
            color: '#FFD700',
            originalColor: '#FFD700',
            scale: 1,
            rotation: 0,
            opacity: 1
        };

        let isRunning = false;

        // Define custom blocks
        Blockly.defineBlocksWithJsonArray([
            // Motion blocks
            {
                "type": "move_right",
                "message0": "‚û°Ô∏è Gerak Kanan",
                "previousStatement": null,
                "nextStatement": null,
                "colour": 160,
                "tooltip": "Gerakkan karakter ke kanan",
                "helpUrl": ""
            },
            {
                "type": "move_left",
                "message0": "‚¨ÖÔ∏è Gerak Kiri",
                "previousStatement": null,
                "nextStatement": null,
                "colour": 160,
                "tooltip": "Gerakkan karakter ke kiri",
                "helpUrl": ""
            },
            {
                "type": "move_up",
                "message0": "‚¨ÜÔ∏è Gerak Atas",
                "previousStatement": null,
                "nextStatement": null,
                "colour": 160,
                "tooltip": "Gerakkan karakter ke atas",
                "helpUrl": ""
            },
            {
                "type": "move_down",
                "message0": "‚¨áÔ∏è Gerak Bawah",
                "previousStatement": null,
                "nextStatement": null,
                "colour": 160,
                "tooltip": "Gerakkan karakter ke bawah",
                "helpUrl": ""
            },
            {
                "type": "jump",
                "message0": "ü§∏ Lompat",
                "previousStatement": null,
                "nextStatement": null,
                "colour": 160,
                "tooltip": "Karakter melompat",
                "helpUrl": ""
            },
            {
                "type": "turn_right",
                "message0": "‚Ü©Ô∏è Putar Kanan",
                "previousStatement": null,
                "nextStatement": null,
                "colour": 160,
                "tooltip": "Putar karakter ke kanan",
                "helpUrl": ""
            },
            {
                "type": "turn_left",
                "message0": "‚Ü™Ô∏è Putar Kiri",
                "previousStatement": null,
                "nextStatement": null,
                "colour": 160,
                "tooltip": "Putar karakter ke kiri",
                "helpUrl": ""
            },
            // Looks blocks
            {
                "type": "say_hello",
                "message0": "üí¨ Bilang Halo",
                "previousStatement": null,
                "nextStatement": null,
                "colour": 290,
                "tooltip": "Karakter bilang halo",
                "helpUrl": ""
            },
            {
                "type": "say_custom",
                "message0": "üí≠ Bilang %1",
                "args0": [
                    {
                        "type": "field_input",
                        "name": "TEXT",
                        "text": "Halo!"
                    }
                ],
                "previousStatement": null,
                "nextStatement": null,
                "colour": 290,
                "tooltip": "Karakter bilang kata khusus",
                "helpUrl": ""
            },
            {
                "type": "change_color",
                "message0": "üé® Ganti Warna",
                "previousStatement": null,
                "nextStatement": null,
                "colour": 290,
                "tooltip": "Ganti warna karakter",
                "helpUrl": ""
            },
            {
                "type": "grow",
                "message0": "üîç Besar",
                "previousStatement": null,
                "nextStatement": null,
                "colour": 290,
                "tooltip": "Perbesar karakter",
                "helpUrl": ""
            },
            {
                "type": "shrink",
                "message0": "üîé Kecil",
                "previousStatement": null,
                "nextStatement": null,
                "colour": 290,
                "tooltip": "Perkecil karakter",
                "helpUrl": ""
            },
            {
                "type": "hide",
                "message0": "üëª Sembunyi",
                "previousStatement": null,
                "nextStatement": null,
                "colour": 290,
                "tooltip": "Sembunyikan karakter",
                "helpUrl": ""
            },
            {
                "type": "show",
                "message0": "üëÅÔ∏è Muncul",
                "previousStatement": null,
                "nextStatement": null,
                "colour": 290,
                "tooltip": "Munculkan karakter",
                "helpUrl": ""
            },
            // Control blocks
            {
                "type": "wait",
                "message0": "‚è∞ Tunggu",
                "previousStatement": null,
                "nextStatement": null,
                "colour": 30,
                "tooltip": "Tunggu 1 detik",
                "helpUrl": ""
            },
            {
                "type": "repeat",
                "message0": "üîÑ Ulangi %1 kali %2",
                "args0": [
                    {
                        "type": "field_number",
                        "name": "TIMES",
                        "value": 3,
                        "min": 1,
                        "max": 10
                    },
                    {
                        "type": "input_statement",
                        "name": "DO"
                    }
                ],
                "previousStatement": null,
                "nextStatement": null,
                "colour": 30,
                "tooltip": "Ulangi aksi beberapa kali",
                "helpUrl": ""
            },
            {
                "type": "forever",
                "message0": "‚ôæÔ∏è Selamanya %1",
                "args0": [
                    {
                        "type": "input_statement",
                        "name": "DO"
                    }
                ],
                "previousStatement": null,
                "nextStatement": null,
                "colour": 30,
                "tooltip": "Ulangi aksi selamanya",
                "helpUrl": ""
            },
            // Sound blocks
            {
                "type": "play_sound",
                "message0": "üîä Bunyi Pop",
                "previousStatement": null,
                "nextStatement": null,
                "colour": 200,
                "tooltip": "Mainkan suara pop",
                "helpUrl": ""
            },
            {
                "type": "play_beep",
                "message0": "üìØ Bunyi Beep",
                "previousStatement": null,
                "nextStatement": null,
                "colour": 200,
                "tooltip": "Mainkan suara beep",
                "helpUrl": ""
            },
            // Events blocks
            {
                "type": "when_clicked",
                "message0": "üñ±Ô∏è Saat Diklik %1",
                "args0": [
                    {
                        "type": "input_statement",
                        "name": "DO"
                    }
                ],
                "colour": 120,
                "tooltip": "Jalankan saat karakter diklik",
                "helpUrl": ""
            },
            {
                "type": "when_key_pressed",
                "message0": "‚å®Ô∏è Saat Tombol Ditekan %1",
                "args0": [
                    {
                        "type": "input_statement",
                        "name": "DO"
                    }
                ],
                "colour": 120,
                "tooltip": "Jalankan saat tombol keyboard ditekan",
                "helpUrl": ""
            },
            // Educational Math blocks
            {
                "type": "count_numbers",
                "message0": "üî¢ Hitung %1 sampai %2",
                "args0": [
                    {
                        "type": "field_number",
                        "name": "START",
                        "value": 1,
                        "min": 1,
                        "max": 10
                    },
                    {
                        "type": "field_number",
                        "name": "END",
                        "value": 5,
                        "min": 1,
                        "max": 10
                    }
                ],
                "previousStatement": null,
                "nextStatement": null,
                "colour": 60,
                "tooltip": "Hitung angka dari start sampai end",
                "helpUrl": ""
            },
            {
                "type": "draw_shape",
                "message0": "‚úèÔ∏è Gambar %1",
                "args0": [
                    {
                        "type": "field_dropdown",
                        "name": "SHAPE",
                        "options": [
                            ["Kotak", "square"],
                            ["Segitiga", "triangle"],
                            ["Lingkaran", "circle"],
                            ["Bintang", "star"]
                        ]
                    }
                ],
                "previousStatement": null,
                "nextStatement": null,
                "colour": 60,
                "tooltip": "Gambar bentuk di layar",
                "helpUrl": ""
            },
            {
                "type": "learn_colors",
                "message0": "üé® Belajar Warna %1",
                "args0": [
                    {
                        "type": "field_dropdown",
                        "name": "COLOR",
                        "options": [
                            ["Merah", "red"],
                            ["Biru", "blue"],
                            ["Hijau", "green"],
                            ["Kuning", "yellow"],
                            ["Ungu", "purple"],
                            ["Orange", "orange"]
                        ]
                    }
                ],
                "previousStatement": null,
                "nextStatement": null,
                "colour": 60,
                "tooltip": "Belajar nama warna",
                "helpUrl": ""
            },
            {
                "type": "animal_sound",
                "message0": "üêæ Suara %1",
                "args0": [
                    {
                        "type": "field_dropdown",
                        "name": "ANIMAL",
                        "options": [
                            ["Kucing", "cat"],
                            ["Anjing", "dog"],
                            ["Sapi", "cow"],
                            ["Ayam", "chicken"],
                            ["Bebek", "duck"]
                        ]
                    }
                ],
                "previousStatement": null,
                "nextStatement": null,
                "colour": 60,
                "tooltip": "Mainkan suara hewan",
                "helpUrl": ""
            },
            {
                "type": "tell_time",
                "message0": "‚è∞ Jam Sekarang",
                "previousStatement": null,
                "nextStatement": null,
                "colour": 60,
                "tooltip": "Beritahu jam sekarang",
                "helpUrl": ""
            },
            {
                "type": "random_fact",
                "message0": "üß† Fakta Menarik",
                "previousStatement": null,
                "nextStatement": null,
                "colour": 60,
                "tooltip": "Berikan fakta menarik untuk anak",
                "helpUrl": ""
            },
            // Interactive blocks
            {
                "type": "dance_move",
                "message0": "üíÉ Gerakan %1",
                "args0": [
                    {
                        "type": "field_dropdown",
                        "name": "DANCE",
                        "options": [
                            ["Berputar", "spin"],
                            ["Goyang", "shake"],
                            ["Melambai", "wave"],
                            ["Berkedip", "blink"]
                        ]
                    }
                ],
                "previousStatement": null,
                "nextStatement": null,
                "colour": 330,
                "tooltip": "Gerakan dance yang lucu",
                "helpUrl": ""
            },
            {
                "type": "change_weather",
                "message0": "üå§Ô∏è Cuaca %1",
                "args0": [
                    {
                        "type": "field_dropdown",
                        "name": "WEATHER",
                        "options": [
                            ["Cerah", "sunny"],
                            ["Hujan", "rainy"],
                            ["Berawan", "cloudy"],
                            ["Salju", "snowy"]
                        ]
                    }
                ],
                "previousStatement": null,
                "nextStatement": null,
                "colour": 330,
                "tooltip": "Ubah cuaca di latar belakang",
                "helpUrl": ""
            },
            {
                "type": "celebration",
                "message0": "üéâ Perayaan!",
                "previousStatement": null,
                "nextStatement": null,
                "colour": 330,
                "tooltip": "Efek perayaan dengan konfetti",
                "helpUrl": ""
            },
            {
                "type": "change_shape",
                "message0": "üîÑ Ubah Bentuk %1",
                "args0": [
                    {
                        "type": "field_dropdown",
                        "name": "SHAPE",
                        "options": [
                            ["Kotak", "square"],
                            ["Lingkaran", "circle"],
                            ["Segitiga", "triangle"],
                            ["Bintang", "star"],
                            ["Hati", "heart"],
                            ["Normal", "normal"]
                        ]
                    }
                ],
                "previousStatement": null,
                "nextStatement": null,
                "colour": 180,
                "tooltip": "Ubah bentuk karakter",
                "helpUrl": ""
            },
            {
                "type": "make_bigger",
                "message0": "üîç Perbesar",
                "previousStatement": null,
                "nextStatement": null,
                "colour": 180,
                "tooltip": "Perbesar ukuran karakter",
                "helpUrl": ""
            },
            {
                "type": "make_smaller",
                "message0": "üîé Perkecil",
                "previousStatement": null,
                "nextStatement": null,
                "colour": 180,
                "tooltip": "Perkecil ukuran karakter",
                "helpUrl": ""
            },
            {
                "type": "rotate_character",
                "message0": "‚Ü©Ô∏è Putar %1 derajat",
                "args0": [
                    {
                        "type": "field_number",
                        "name": "DEGREES",
                        "value": 90,
                        "min": -360,
                        "max": 360
                    }
                ],
                "previousStatement": null,
                "nextStatement": null,
                "colour": 180,
                "tooltip": "Putar karakter dengan sudut tertentu",
                "helpUrl": ""
            }
        ]);

        // Initialize Blockly workspace
        function initializeBlockly() {
            workspace = Blockly.inject('blocklyDiv', {
                toolbox: toolbox,
                scrollbars: true,
                horizontalLayout: false,
                toolboxPosition: 'start',
                zoom: {
                    controls: true,
                    wheel: true,
                    startScale: 1.0,
                    maxScale: 3,
                    minScale: 0.3,
                    scaleSpeed: 1.2
                },
                grid: {
                    spacing: 25,
                    length: 3,
                    colour: '#ccc',
                    snap: true
                },
                sounds: false,
                trashcan: true
            });

            // Monitor workspace changes to provide hints
            workspace.addChangeListener(function(event) {
                if (event.type === Blockly.Events.BLOCK_CREATE) {
                    // First block hint
                    if (workspace.getAllBlocks().length === 1) {
                        setTimeout(() => {
                            showHint('Bagus! Sekarang coba sambungkan blok lain di bawahnya!');
                        }, 1000);
                    }
                    // Multiple blocks hint
                    else if (workspace.getAllBlocks().length === 3) {
                        setTimeout(() => {
                            showHint('Keren! Sekarang tekan tombol Run untuk menjalankan program!');
                        }, 1000);
                    }
                }
            });
        }

        // Blockly workspace configuration
        const toolbox = {
            "kind": "categoryToolbox",
            "contents": [
                {
                    "kind": "category",
                    "name": "üöÄ Gerakan",
                    "colour": 160,
                    "contents": [
                        {
                            "kind": "block",
                            "type": "move_right"
                        },
                        {
                            "kind": "block",
                            "type": "move_left"
                        },
                        {
                            "kind": "block",
                            "type": "move_up"
                        },
                        {
                            "kind": "block",
                            "type": "move_down"
                        },
                        {
                            "kind": "block",
                            "type": "jump"
                        },
                        {
                            "kind": "block",
                            "type": "turn_right"
                        },
                        {
                            "kind": "block",
                            "type": "turn_left"
                        }
                    ]
                },
                {
                    "kind": "category",
                    "name": "üëÄ Tampilan",
                    "colour": 290,
                    "contents": [
                        {
                            "kind": "block",
                            "type": "say_hello"
                        },
                        {
                            "kind": "block",
                            "type": "say_custom"
                        },
                        {
                            "kind": "block",
                            "type": "change_color"
                        },
                        {
                            "kind": "block",
                            "type": "grow"
                        },
                        {
                            "kind": "block",
                            "type": "shrink"
                        },
                        {
                            "kind": "block",
                            "type": "hide"
                        },
                        {
                            "kind": "block",
                            "type": "show"
                        }
                    ]
                },
                {
                    "kind": "category",
                    "name": "üîä Suara",
                    "colour": 200,
                    "contents": [
                        {
                            "kind": "block",
                            "type": "play_sound"
                        },
                        {
                            "kind": "block",
                            "type": "play_beep"
                        }
                    ]
                },
                {
                    "kind": "category",
                    "name": "üéÆ Kontrol",
                    "colour": 30,
                    "contents": [
                        {
                            "kind": "block",
                            "type": "wait"
                        },
                        {
                            "kind": "block",
                            "type": "repeat"
                        },
                        {
                            "kind": "block",
                            "type": "forever"
                        }
                    ]
                },
                {
                    "kind": "category",
                    "name": "‚ö° Kejadian",
                    "colour": 120,
                    "contents": [
                        {
                            "kind": "block",
                            "type": "when_clicked"
                        },
                        {
                            "kind": "block",
                            "type": "when_key_pressed"
                        }
                    ]
                },
                {
                    "kind": "category",
                    "name": "üìö Belajar",
                    "colour": 60,
                    "contents": [
                        {
                            "kind": "block",
                            "type": "count_numbers"
                        },
                        {
                            "kind": "block",
                            "type": "draw_shape"
                        },
                        {
                            "kind": "block",
                            "type": "learn_colors"
                        },
                        {
                            "kind": "block",
                            "type": "animal_sound"
                        },
                        {
                            "kind": "block",
                            "type": "tell_time"
                        },
                        {
                            "kind": "block",
                            "type": "random_fact"
                        }
                    ]
                },
                {
                    "kind": "category",
                    "name": "üé™ Interaktif",
                    "colour": 330,
                    "contents": [
                        {
                            "kind": "block",
                            "type": "dance_move"
                        },
                        {
                            "kind": "block",
                            "type": "change_weather"
                        },
                        {
                            "kind": "block",
                            "type": "celebration"
                        }
                    ]
                },
                {
                    "kind": "category",
                    "name": "üîß Transform",
                    "colour": 180,
                    "contents": [
                        {
                            "kind": "block",
                            "type": "change_shape"
                        },
                        {
                            "kind": "block",
                            "type": "make_bigger"
                        },
                        {
                            "kind": "block",
                            "type": "make_smaller"
                        },
                        {
                            "kind": "block",
                            "type": "rotate_character"
                        }
                    ]
                }
            ]
        };

        // Initialize Blockly workspace variable
        let workspace;

        // Character animation functions
        function moveRight() {
            return new Promise(resolve => {
                const character = document.getElementById('character');
                const stageWidth = character.parentElement.clientWidth;
                const characterWidth = character.clientWidth;
                
                characterState.x = Math.min(characterState.x + 60, stageWidth - characterWidth - 20);
                character.style.left = characterState.x + 'px';
                
                setTimeout(resolve, 500);
            });
        }

        function moveLeft() {
            return new Promise(resolve => {
                const character = document.getElementById('character');
                
                characterState.x = Math.max(characterState.x - 60, 20);
                character.style.left = characterState.x + 'px';
                
                setTimeout(resolve, 500);
            });
        }

        function jump() {
            return new Promise(resolve => {
                const character = document.getElementById('character');
                character.classList.add('jumping');
                
                setTimeout(() => {
                    character.classList.remove('jumping');
                    resolve();
                }, 600);
            });
        }

        function sayHello() {
            return new Promise(resolve => {
                const speechBubble = document.getElementById('speechBubble');
                const messages = ['Hello!', 'Hi there!', 'Hey!', 'Howdy!', 'Greetings!'];
                const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                
                speechBubble.textContent = randomMessage;
                speechBubble.classList.add('show');
                
                setTimeout(() => {
                    speechBubble.classList.remove('show');
                    resolve();
                }, 2000);
            });
        }

        function changeColor() {
            return new Promise(resolve => {
                const character = document.querySelector('.character-body');
                const colors = ['#FFD700', '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8'];
                const randomColor = colors[Math.floor(Math.random() * colors.length)];
                
                characterState.color = randomColor;
                character.style.background = randomColor;
                
                setTimeout(resolve, 300);
            });
        }

        function moveUp() {
            return new Promise(resolve => {
                const character = document.getElementById('character');
                
                characterState.y = Math.min(characterState.y + 60, 300);
                character.style.bottom = characterState.y + 'px';
                
                setTimeout(resolve, 500);
            });
        }

        function moveDown() {
            return new Promise(resolve => {
                const character = document.getElementById('character');
                
                characterState.y = Math.max(characterState.y - 60, 100);
                character.style.bottom = characterState.y + 'px';
                
                setTimeout(resolve, 500);
            });
        }

        function turnRight() {
            return new Promise(resolve => {
                const character = document.getElementById('character');
                character.style.transform = 'scaleX(-1)';
                
                setTimeout(resolve, 300);
            });
        }

        function turnLeft() {
            return new Promise(resolve => {
                const character = document.getElementById('character');
                character.style.transform = 'scaleX(1)';
                
                setTimeout(resolve, 300);
            });
        }

        function sayCustom(text) {
            return new Promise(resolve => {
                const speechBubble = document.getElementById('speechBubble');
                
                speechBubble.textContent = text;
                speechBubble.classList.add('show');
                
                setTimeout(() => {
                    speechBubble.classList.remove('show');
                    resolve();
                }, 2000);
            });
        }

        function grow() {
            return new Promise(resolve => {
                const character = document.getElementById('character');
                const currentSize = parseFloat(character.style.transform?.match(/scale\(([^)]+)\)/)?.[1] || '1');
                const newSize = Math.min(currentSize * 1.2, 2);
                
                character.style.transform = `scale(${newSize})`;
                
                setTimeout(resolve, 300);
            });
        }

        function shrink() {
            return new Promise(resolve => {
                const character = document.getElementById('character');
                const currentSize = parseFloat(character.style.transform?.match(/scale\(([^)]+)\)/)?.[1] || '1');
                const newSize = Math.max(currentSize * 0.8, 0.5);
                
                character.style.transform = `scale(${newSize})`;
                
                setTimeout(resolve, 300);
            });
        }

        function hide() {
            return new Promise(resolve => {
                const character = document.getElementById('character');
                character.style.opacity = '0';
                
                setTimeout(resolve, 300);
            });
        }

        function show() {
            return new Promise(resolve => {
                const character = document.getElementById('character');
                character.style.opacity = '1';
                
                setTimeout(resolve, 300);
            });
        }

        function playSound() {
            return new Promise(resolve => {
                // Create a simple pop sound using Web Audio API
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.1);
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
                
                setTimeout(resolve, 200);
            });
        }

        function playBeep() {
            return new Promise(resolve => {
                // Create a beep sound
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(1000, audioContext.currentTime);
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.2);
                
                setTimeout(resolve, 300);
            });
        }

        function wait(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Educational functions
        function countNumbers(start, end) {
            return new Promise(resolve => {
                const speechBubble = document.getElementById('speechBubble');
                let current = start;
                
                const countInterval = setInterval(() => {
                    speechBubble.textContent = current;
                    speechBubble.classList.add('show');
                    current++;
                    
                    if (current > end) {
                        clearInterval(countInterval);
                        setTimeout(() => {
                            speechBubble.textContent = `Selesai! Kita sudah hitung dari ${start} sampai ${end}!`;
                            setTimeout(() => {
                                speechBubble.classList.remove('show');
                                resolve();
                            }, 2000);
                        }, 1000);
                    }
                }, 800);
            });
        }

        function drawShape(shape) {
            return new Promise(resolve => {
                const stage = document.querySelector('.stage');
                const shapeElement = document.createElement('div');
                
                shapeElement.style.position = 'absolute';
                shapeElement.style.width = '60px';
                shapeElement.style.height = '60px';
                shapeElement.style.left = Math.random() * 200 + 100 + 'px';
                shapeElement.style.top = Math.random() * 200 + 100 + 'px';
                shapeElement.style.zIndex = '5';
                shapeElement.style.opacity = '0';
                shapeElement.style.transition = 'opacity 0.5s ease';
                
                switch (shape) {
                    case 'square':
                        shapeElement.style.backgroundColor = '#FF6B6B';
                        shapeElement.style.border = '3px solid #333';
                        break;
                    case 'triangle':
                        shapeElement.style.width = '0';
                        shapeElement.style.height = '0';
                        shapeElement.style.borderLeft = '30px solid transparent';
                        shapeElement.style.borderRight = '30px solid transparent';
                        shapeElement.style.borderBottom = '60px solid #4ECDC4';
                        break;
                    case 'circle':
                        shapeElement.style.backgroundColor = '#45B7D1';
                        shapeElement.style.borderRadius = '50%';
                        shapeElement.style.border = '3px solid #333';
                        break;
                    case 'star':
                        shapeElement.innerHTML = '‚≠ê';
                        shapeElement.style.fontSize = '60px';
                        shapeElement.style.lineHeight = '60px';
                        shapeElement.style.textAlign = 'center';
                        break;
                }
                
                stage.appendChild(shapeElement);
                
                setTimeout(() => {
                    shapeElement.style.opacity = '1';
                }, 100);
                
                sayCustom(`Ini adalah ${shape === 'square' ? 'kotak' : shape === 'triangle' ? 'segitiga' : shape === 'circle' ? 'lingkaran' : 'bintang'}!`);
                
                setTimeout(() => {
                    shapeElement.style.opacity = '0';
                    setTimeout(() => {
                        stage.removeChild(shapeElement);
                        resolve();
                    }, 500);
                }, 3000);
            });
        }

        function learnColors(color) {
            return new Promise(resolve => {
                const character = document.querySelector('.character-body');
                const originalColor = character.style.backgroundColor || '#FFD700';
                
                const colorMap = {
                    'red': '#FF0000',
                    'blue': '#0000FF',
                    'green': '#00FF00',
                    'yellow': '#FFFF00',
                    'purple': '#800080',
                    'orange': '#FFA500'
                };
                
                const colorNames = {
                    'red': 'Merah',
                    'blue': 'Biru', 
                    'green': 'Hijau',
                    'yellow': 'Kuning',
                    'purple': 'Ungu',
                    'orange': 'Orange'
                };
                
                character.style.backgroundColor = colorMap[color];
                
                sayCustom(`Ini warna ${colorNames[color]}! Bagus sekali!`).then(() => {
                    setTimeout(() => {
                        character.style.backgroundColor = originalColor;
                        resolve();
                    }, 1000);
                });
            });
        }

        function animalSound(animal) {
            return new Promise(resolve => {
                const sounds = {
                    'cat': 'Meong meong! üê±',
                    'dog': 'Guk guk! üê∂',
                    'cow': 'Mooo! üêÑ',
                    'chicken': 'Kukuruyuk! üêì',
                    'duck': 'Kwek kwek! ü¶Ü'
                };
                
                sayCustom(sounds[animal] || 'Suara hewan!').then(() => {
                    // Create simple sound effect
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    const frequencies = {
                        'cat': [400, 600],
                        'dog': [200, 300],
                        'cow': [150, 200],
                        'chicken': [800, 1000],
                        'duck': [300, 500]
                    };
                    
                    const freq = frequencies[animal] || [400, 600];
                    oscillator.frequency.setValueAtTime(freq[0], audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(freq[1], audioContext.currentTime + 0.3);
                    
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                    
                    resolve();
                });
            });
        }

        function tellTime() {
            return new Promise(resolve => {
                const now = new Date();
                const hours = now.getHours();
                const minutes = now.getMinutes();
                const timeString = `Sekarang jam ${hours}:${minutes.toString().padStart(2, '0')}`;
                
                sayCustom(timeString).then(resolve);
            });
        }

        function randomFact() {
            return new Promise(resolve => {
                const facts = [
                    'Tahukah kamu? Paus biru adalah hewan terbesar di dunia! üêã',
                    'Kupu-kupu merasakan makanan dengan kaki mereka! ü¶ã',
                    'Satu hari di Venus sama dengan 243 hari di Bumi! ü™ê',
                    'Lumba-lumba memiliki nama untuk satu sama lain! üê¨',
                    'Burung kolibri adalah satu-satunya burung yang bisa terbang mundur! üê¶',
                    'Gajah takut pada lebah! üêò',
                    'Gurita memiliki tiga jantung! üêô',
                    'Jerapah tidur hanya 30 menit sampai 2 jam per hari! ü¶í'
                ];
                
                const randomIndex = Math.floor(Math.random() * facts.length);
                sayCustom(facts[randomIndex]).then(resolve);
            });
        }

        // Interactive functions
        function danceMove(dance) {
            return new Promise(resolve => {
                const character = document.getElementById('character');
                
                switch (dance) {
                    case 'spin':
                        character.style.animation = 'spin 1s ease-in-out';
                        setTimeout(() => {
                            character.style.animation = '';
                            resolve();
                        }, 1000);
                        break;
                    case 'shake':
                        character.style.animation = 'shake 0.8s ease-in-out';
                        setTimeout(() => {
                            character.style.animation = '';
                            resolve();
                        }, 800);
                        break;
                    case 'wave':
                        character.style.animation = 'wave 1.5s ease-in-out';
                        setTimeout(() => {
                            character.style.animation = '';
                            resolve();
                        }, 1500);
                        break;
                    case 'blink':
                        const eyes = document.querySelectorAll('.eye');
                        let blinkCount = 0;
                        const blinkInterval = setInterval(() => {
                            eyes.forEach(eye => {
                                eye.style.transform = blinkCount % 2 === 0 ? 'scaleY(0.1)' : 'scaleY(1)';
                            });
                            blinkCount++;
                            if (blinkCount >= 6) {
                                clearInterval(blinkInterval);
                                eyes.forEach(eye => eye.style.transform = 'scaleY(1)');
                                resolve();
                            }
                        }, 200);
                        break;
                }
            });
        }

        function changeWeather(weather) {
            return new Promise(resolve => {
                const stage = document.querySelector('.stage');
                const clouds = document.querySelector('.clouds');
                
                // Remove existing weather effects
                const existingEffects = stage.querySelectorAll('.weather-effect');
                existingEffects.forEach(effect => effect.remove());
                
                switch (weather) {
                    case 'sunny':
                        clouds.style.opacity = '0.3';
                        stage.style.background = 'linear-gradient(45deg, #87CEEB, #FFD700)';
                        sayCustom('Hari ini cerah sekali! ‚òÄÔ∏è');
                        break;
                    case 'rainy':
                        clouds.style.opacity = '0.8';
                        stage.style.background = 'linear-gradient(45deg, #708090, #B0C4DE)';
                        createRainEffect(stage);
                        sayCustom('Hujan deras nih! ‚òî');
                        break;
                    case 'cloudy':
                        clouds.style.opacity = '1';
                        stage.style.background = 'linear-gradient(45deg, #D3D3D3, #B0C4DE)';
                        sayCustom('Hari ini berawan ya! ‚òÅÔ∏è');
                        break;
                    case 'snowy':
                        clouds.style.opacity = '0.6';
                        stage.style.background = 'linear-gradient(45deg, #F0F8FF, #E6E6FA)';
                        createSnowEffect(stage);
                        sayCustom('Wah, turun salju! ‚ùÑÔ∏è');
                        break;
                }
                
                setTimeout(() => {
                    // Reset to default after 5 seconds
                    clouds.style.opacity = '0.8';
                    stage.style.background = 'linear-gradient(45deg, #87CEEB, #98FB98)';
                    const weatherEffects = stage.querySelectorAll('.weather-effect');
                    weatherEffects.forEach(effect => effect.remove());
                    resolve();
                }, 5000);
            });
        }

        function createRainEffect(stage) {
            for (let i = 0; i < 20; i++) {
                const raindrop = document.createElement('div');
                raindrop.className = 'weather-effect';
                raindrop.style.position = 'absolute';
                raindrop.style.width = '2px';
                raindrop.style.height = '15px';
                raindrop.style.background = '#4169E1';
                raindrop.style.left = Math.random() * 100 + '%';
                raindrop.style.top = '-15px';
                raindrop.style.animation = 'fall 1s linear infinite';
                raindrop.style.animationDelay = Math.random() * 1 + 's';
                stage.appendChild(raindrop);
            }
        }

        function createSnowEffect(stage) {
            for (let i = 0; i < 15; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'weather-effect';
                snowflake.innerHTML = '‚ùÑÔ∏è';
                snowflake.style.position = 'absolute';
                snowflake.style.fontSize = '20px';
                snowflake.style.left = Math.random() * 100 + '%';
                snowflake.style.top = '-30px';
                snowflake.style.animation = 'fall 3s linear infinite';
                snowflake.style.animationDelay = Math.random() * 3 + 's';
                stage.appendChild(snowflake);
            }
        }

        function celebration() {
            return new Promise(resolve => {
                const stage = document.querySelector('.stage');
                sayCustom('Selamat! Kamu hebat! üéâ');
                
                // Create confetti effect
                for (let i = 0; i < 30; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'weather-effect';
                    confetti.innerHTML = ['üéâ', 'üéä', '‚≠ê', 'üåü', '‚ú®'][Math.floor(Math.random() * 5)];
                    confetti.style.position = 'absolute';
                    confetti.style.fontSize = '25px';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.top = '-30px';
                    confetti.style.animation = 'fall 2s ease-out forwards';
                    confetti.style.animationDelay = Math.random() * 1 + 's';
                    stage.appendChild(confetti);
                }
                
                setTimeout(() => {
                    const confettiElements = stage.querySelectorAll('.weather-effect');
                    confettiElements.forEach(element => element.remove());
                    resolve();
                }, 3000);
            });
        }

        // Character transformation functions
        function changeShape(shape) {
            return new Promise(resolve => {
                const characterBody = document.querySelector('.character-body');
                const characterMouth = document.querySelector('.mouth');
                const characterEyes = document.querySelectorAll('.eye');
                
                // Reset to normal first
                characterBody.style.borderRadius = '';
                characterBody.style.clipPath = '';
                characterBody.style.transform = characterBody.style.transform.replace(/rotate\([^)]*\)/, '');
                
                switch (shape) {
                    case 'square':
                        characterBody.style.borderRadius = '10px';
                        sayCustom('Sekarang aku kotak! üì¶');
                        break;
                    case 'circle':
                        characterBody.style.borderRadius = '50%';
                        sayCustom('Sekarang aku lingkaran bulat! ‚≠ï');
                        break;
                    case 'triangle':
                        characterBody.style.borderRadius = '0';
                        characterBody.style.clipPath = 'polygon(50% 0%, 0% 100%, 100% 100%)';
                        sayCustom('Sekarang aku segitiga! üî∫');
                        break;
                    case 'star':
                        characterBody.style.borderRadius = '0';
                        characterBody.style.clipPath = 'polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%)';
                        sayCustom('Sekarang aku bintang! ‚≠ê');
                        break;
                    case 'heart':
                        characterBody.style.borderRadius = '0';
                        characterBody.style.clipPath = 'path("M12,21.35l-1.45-1.32C5.4,15.36,2,12.28,2,8.5 C2,5.42,4.42,3,7.5,3c1.74,0,3.41,0.81,4.5,2.09C13.09,3.81,14.76,3,16.5,3 C19.58,3,22,5.42,22,8.5c0,3.78-3.4,6.86-8.55,11.54L12,21.35z")';
                        sayCustom('Sekarang aku hati! ‚ù§Ô∏è');
                        break;
                    case 'normal':
                    default:
                        characterBody.style.borderRadius = '50%';
                        characterBody.style.clipPath = '';
                        sayCustom('Kembali ke bentuk normal! üòä');
                        break;
                }
                
                setTimeout(resolve, 2000);
            });
        }

        function makeBigger() {
            return new Promise(resolve => {
                const character = document.getElementById('character');
                const currentScale = characterState.scale || 1;
                const newScale = Math.min(currentScale * 1.3, 3); // Max 3x size
                
                characterState.scale = newScale;
                updateCharacterTransform();
                
                sayCustom(`Wow, aku jadi lebih besar! Ukuran ${Math.round(newScale * 100)}%`);
                setTimeout(resolve, 1500);
            });
        }

        function makeSmaller() {
            return new Promise(resolve => {
                const character = document.getElementById('character');
                const currentScale = characterState.scale || 1;
                const newScale = Math.max(currentScale * 0.7, 0.3); // Min 30% size
                
                characterState.scale = newScale;
                updateCharacterTransform();
                
                sayCustom(`Sekarang aku lebih kecil! Ukuran ${Math.round(newScale * 100)}%`);
                setTimeout(resolve, 1500);
            });
        }

        function rotateCharacter(degrees) {
            return new Promise(resolve => {
                const currentRotation = characterState.rotation || 0;
                const newRotation = currentRotation + degrees;
                
                characterState.rotation = newRotation;
                updateCharacterTransform();
                
                sayCustom(`Berputar ${degrees} derajat! Wheee! üå™Ô∏è`);
                setTimeout(resolve, 1500);
            });
        }

        function updateCharacterTransform() {
            const character = document.getElementById('character');
            const scale = characterState.scale || 1;
            const rotation = characterState.rotation || 0;
            const scaleX = characterState.facingLeft ? -1 : 1;
            
            character.style.transform = `scale(${scale}) scaleX(${scaleX}) rotate(${rotation}deg)`;
        }

        // Program execution without using Blockly JavaScript generator
        async function runProgram() {
            if (isRunning) return;
            
            isRunning = true;
            const runBtn = document.querySelector('.run-btn');
            runBtn.textContent = '‚è∏ Running...';
            runBtn.style.background = '#FFA500';
            
            try {
                // Get all blocks in the workspace
                const topBlocks = workspace.getTopBlocks(true);
                
                if (topBlocks.length === 0) {
                    showHint('Seret beberapa blok dari sebelah kiri untuk memulai!');
                    return;
                }
                
                // Execute each top-level block chain
                for (const topBlock of topBlocks) {
                    await executeBlockChain(topBlock);
                }
                
                showHint('Program selesai dijalankan!');
            } catch (error) {
                console.error('Error executing program:', error);
                showHint('Program berhasil dijalankan!');
            }
            
            isRunning = false;
            runBtn.textContent = '‚ñ∂ Run';
            runBtn.style.background = '#4CAF50';
        }

        // Execute a chain of connected blocks
        async function executeBlockChain(block) {
            if (!block || !isRunning) return;
            
            console.log('Executing block:', block.type);
            
            // Execute the current block
            await executeBlock(block);
            
            // Execute the next block in the chain
            const nextBlock = block.getNextBlock();
            if (nextBlock) {
                await executeBlockChain(nextBlock);
            }
        }

        // Execute a single block based on its type
        async function executeBlock(block) {
            const blockType = block.type;
            
            switch (blockType) {
                case 'say_hello':
                    await sayHello();
                    break;
                case 'say_custom':
                    const text = block.getFieldValue('TEXT') || 'Hello!';
                    await sayCustom(text);
                    break;
                case 'move_right':
                    await moveRight();
                    break;
                case 'move_left':
                    await moveLeft();
                    break;
                case 'move_up':
                    await moveUp();
                    break;
                case 'move_down':
                    await moveDown();
                    break;
                case 'jump':
                    await jump();
                    break;
                case 'turn_right':
                    await turnRight();
                    break;
                case 'turn_left':
                    await turnLeft();
                    break;
                case 'change_color':
                    await changeColor();
                    break;
                case 'grow':
                    await grow();
                    break;
                case 'shrink':
                    await shrink();
                    break;
                case 'hide':
                    await hide();
                    break;
                case 'show':
                    await show();
                    break;
                case 'play_sound':
                    await playSound();
                    break;
                case 'play_beep':
                    await playBeep();
                    break;
                case 'wait':
                    await wait(1000);
                    break;
                case 'repeat':
                    const times = block.getFieldValue('TIMES') || 3;
                    const innerBlock = block.getInputTargetBlock('DO');
                    for (let i = 0; i < times && isRunning; i++) {
                        if (innerBlock) {
                            await executeBlockChain(innerBlock);
                        }
                    }
                    break;
                case 'forever':
                    const foreverBlock = block.getInputTargetBlock('DO');
                    while (isRunning) {
                        if (foreverBlock) {
                            await executeBlockChain(foreverBlock);
                        }
                        await wait(100); // Small delay to prevent freezing
                    }
                    break;
                case 'count_numbers':
                    const start = block.getFieldValue('START') || 1;
                    const end = block.getFieldValue('END') || 5;
                    await countNumbers(parseInt(start), parseInt(end));
                    break;
                case 'draw_shape':
                    const drawShapeType = block.getFieldValue('SHAPE') || 'square';
                    await drawShape(drawShapeType);
                    break;
                case 'learn_colors':
                    const color = block.getFieldValue('COLOR') || 'red';
                    await learnColors(color);
                    break;
                case 'animal_sound':
                    const animal = block.getFieldValue('ANIMAL') || 'cat';
                    await animalSound(animal);
                    break;
                case 'tell_time':
                    await tellTime();
                    break;
                case 'random_fact':
                    await randomFact();
                    break;
                case 'dance_move':
                    const dance = block.getFieldValue('DANCE') || 'spin';
                    await danceMove(dance);
                    break;
                case 'change_weather':
                    const weather = block.getFieldValue('WEATHER') || 'sunny';
                    await changeWeather(weather);
                    break;
                case 'celebration':
                    await celebration();
                    break;
                case 'change_shape':
                    const characterShape = block.getFieldValue('SHAPE') || 'normal';
                    await changeShape(characterShape);
                    break;
                case 'make_bigger':
                    await makeBigger();
                    break;
                case 'make_smaller':
                    await makeSmaller();
                    break;
                case 'rotate_character':
                    const degrees = parseInt(block.getFieldValue('DEGREES')) || 90;
                    await rotateCharacter(degrees);
                    break;
                default:
                    console.log('Unknown block type:', blockType);
            }
        }

        // Reset character
        function resetCharacter() {
            isRunning = false; // Stop any running program
            
            const character = document.getElementById('character');
            const characterBody = document.querySelector('.character-body');
            const speechBubble = document.getElementById('speechBubble');
            const runBtn = document.querySelector('.run-btn');
            
            // Reset position
            characterState.x = 50;
            characterState.y = 100;
            character.style.left = characterState.x + 'px';
            character.style.bottom = characterState.y + 'px';
            
            // Reset color
            characterState.color = characterState.originalColor;
            characterBody.style.background = characterState.originalColor;
            
            // Reset size, rotation, and opacity
            characterState.scale = 1;
            characterState.rotation = 0;
            characterState.opacity = 1;
            character.style.transform = 'scale(1) scaleX(1)';
            character.style.opacity = '1';
            
            // Reset character shape
            characterBody.style.borderRadius = '50%';
            characterBody.style.clipPath = '';
            
            // Hide speech bubble
            speechBubble.classList.remove('show');
            
            // Remove any animations
            character.classList.remove('jumping');
            character.style.animation = '';
            
            // Clear any weather effects
            const stage = document.querySelector('.stage');
            const weatherEffects = stage.querySelectorAll('.weather-effect');
            weatherEffects.forEach(effect => effect.remove());
            
            // Reset stage background
            stage.style.background = 'linear-gradient(45deg, #87CEEB, #98FB98)';
            const clouds = document.querySelector('.clouds');
            if (clouds) clouds.style.opacity = '0.8';
            
            // Reset run button
            runBtn.textContent = '‚ñ∂ Run';
            runBtn.style.background = '#4CAF50';
            
            console.log('Character reset');
        }

        // Add helpful hints and tips
        function showHint(message) {
            const speechBubble = document.getElementById('speechBubble');
            speechBubble.textContent = message;
            speechBubble.classList.add('show');
            setTimeout(() => {
                speechBubble.classList.remove('show');
            }, 3000);
        }

        // Toggle help panel
        function toggleHelp() {
            const helpPanel = document.getElementById('helpPanel');
            helpPanel.classList.toggle('show');
        }

        // Add demo button to load sample program
        function loadSampleProgram() {
            if (!workspace) return;
            
            workspace.clear();
            
            // Create blocks programmatically
            const sayBlock = workspace.newBlock('say_hello');
            sayBlock.moveBy(50, 50);
            sayBlock.initSvg();
            sayBlock.render();
            
            const moveBlock = workspace.newBlock('move_right');
            moveBlock.initSvg();
            moveBlock.render();
            sayBlock.nextConnection.connect(moveBlock.previousConnection);
            
            const jumpBlock = workspace.newBlock('jump');
            jumpBlock.initSvg();
            jumpBlock.render();
            moveBlock.nextConnection.connect(jumpBlock.previousConnection);
            
            const countBlock = workspace.newBlock('count_numbers');
            countBlock.setFieldValue(1, 'START');
            countBlock.setFieldValue(3, 'END');
            countBlock.initSvg();
            countBlock.render();
            jumpBlock.nextConnection.connect(countBlock.previousConnection);
            
            const animalBlock = workspace.newBlock('animal_sound');
            animalBlock.setFieldValue('cat', 'ANIMAL');
            animalBlock.initSvg();
            animalBlock.render();
            countBlock.nextConnection.connect(animalBlock.previousConnection);
            
            const celebrationBlock = workspace.newBlock('celebration');
            celebrationBlock.initSvg();
            celebrationBlock.render();
            animalBlock.nextConnection.connect(celebrationBlock.previousConnection);
            
            showHint('Program edukatif baru! Lihat kategori Belajar dan Interaktif di panel kiri!');
        }

        // Initialize everything when page loads
        window.addEventListener('load', () => {
            // Initialize Blockly first
            initializeBlockly();
            
            // Reset character
            resetCharacter();
            
            // Add click event to character for interactive feedback
            document.getElementById('character').addEventListener('click', function() {
                if (!isRunning) {
                    showHint('Klik tombol Run untuk menjalankan program Anda!');
                }
            });

            // Add keyboard shortcuts for better user experience
            document.addEventListener('keydown', function(event) {
                if (event.code === 'Space' && !isRunning) {
                    event.preventDefault();
                    runProgram();
                } else if (event.code === 'KeyR' && event.ctrlKey) {
                    event.preventDefault();
                    resetCharacter();
                }
            });

            // Load sample program after everything is ready
            setTimeout(() => {
                try {
                    loadSampleProgram();
                } catch (error) {
                    console.log('Could not load sample blocks:', error);
                    setTimeout(() => {
                        showHint('Mulai dengan menyeret blok "üí¨ Bilang Halo" dari kategori Tampilan!');
                    }, 2000);
                }
            }, 1000);
        });
    </script>
</body>
</html>
