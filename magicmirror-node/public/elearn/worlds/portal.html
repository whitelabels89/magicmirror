<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>World Builder (Clay)</title>
  <link rel="stylesheet" href="./styles/portal.css" />
</head>
<body>
  <div id="app">
    <canvas id="world"></canvas>

    <div class="hud top-right" aria-label="Mode kontrol play">
      <button id="btnPlay" aria-label="Play">‚ñ∂Ô∏è</button>
      <button id="btnHome" aria-label="Home">üè†</button>
    </div>

  <script>
    async function loadWorlds(){
      const res = await fetch('/elearn/worlds/worlds.json');
      const data = await res.json();
      // Redirect specific worlds that are not ready yet to "coming soon"
      const redirectNames = new Set([
        'Visual Programming','Pythonia','Webtopia',
        'Applandia','Robonix','Aitheris'
      ]);
      const redirectIds = new Set([
        'visual','pythonia','webtopia',
        'applandia','robonix','aitheris'
      ]);
      const openWorldNames = new Set(['Open World']);
      const openWorldIds = new Set(['openworld']);
      data.worlds = data.worlds.map(w => {
        const name = (w.name || '').trim();
        const id = (w.id || '').toString().toLowerCase();
        if (openWorldNames.has(name) || openWorldIds.has(id)) {
          return { ...w, entry: '/elearn/portal.html' };
        }
        if (redirectNames.has(name) || redirectIds.has(id)) {
          return { ...w, entry: '/elearn/worlds/comingsoon.html' };
        }
        return w;
      });
      const grid = document.getElementById('worldGrid');
      grid.innerHTML = data.worlds.map(w=>`
        <article class="portal-card" data-entry="${w.entry}">
          <div class="portal-cover" style="background-image:url('${w.cover || "/elearn/img/map/worldmap3.webp"}')"></div>
          <div class="portal-meta">
            <h3>${w.name}</h3>
            <div class="portal-progress" data-world="${w.id}">
              <span class="ring" title="progress"></span>
              <small>loading...</small>
            </div>
          </div>
        </article>
      `).join('');

    <div class="toolbar bottom" role="toolbar" aria-label="Builder pieces">
      <div class="piece-buttons">
        <button data-piece="straight" aria-label="Rel lurus">‚îÉ</button>
        <button data-piece="curve" aria-label="Rel melengkung">‚§¥Ô∏é</button>
        <button data-piece="slope" aria-label="Rel tanjakan">‚áß</button>
        <button data-piece="loop" aria-label="Rel loop">‚óØ</button>
      </div>
      <div class="actions">
        <button id="btnUndo" aria-label="Undo">‚Ü©Ô∏é</button>
        <button id="btnDelete" aria-label="Hapus rel">üóëÔ∏è</button>
      </div>
      <span class="mode" id="modeLabel">Mode: Build</span>
    </div>

    <div id="toast" class="toast" role="status" aria-live="polite"></div>
  </div>

  <script type="module" src="./js/portal-world.js"></script>
</body>
</html>
