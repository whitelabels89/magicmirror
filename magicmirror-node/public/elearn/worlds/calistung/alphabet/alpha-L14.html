

<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Alpha14L5 – Menulis Suku Kata KV (ba bi bu be bo)</title>
  <link rel="stylesheet" href="theme.css" />
  <script defer src="theme.js"></script>
  <style>
    :root{
      --gap: 14px;
      --radius: 14px;
      --font: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{
      margin:0; padding:20px; font-family:var(--font); background:#fafafa; color:#222;
    }
    .sheet{
      max-width:960px; margin:0 auto; background:#fff; border:3px solid #00000015; border-radius:16px; box-shadow:0 10px 30px #00000010; padding:24px; position:relative;
    }

    h1{margin:12px 0 18px; text-align:center; font-size:28px}
    .toolbar{display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-bottom:14px}

    .headers{
      display:grid; grid-template-columns: repeat(5, 1fr); gap:var(--gap); margin:8px 0 18px;
    }
    .syllable{
      user-select:none; text-align:center; font-weight:900; font-size:28px; padding:12px 6px; border-radius:16px; border:3px solid #00000020; cursor:pointer; transition:box-shadow .15s, transform .1s, border .15s;
    }
    .syllable.active{outline:4px solid #00000020; box-shadow:0 6px 14px #0000001a}
    .s-ba{background:#ffd8c2}
    .s-bi{background:#ffefb9}
    .s-bu{background:#c7e9b5}
    .s-be{background:#cfe1ff}
    .s-bo{background:#cfc5ff}

    .grid{display:grid; grid-template-columns:repeat(5, 1fr); gap:var(--gap)}
    .cell{
      position:relative;
      display:flex;
      align-items:stretch;
      justify-content:center;
      height:140px;
      padding:10px;
      border-radius:14px;
      border:3px solid #00000025;
      background:#fff;
      cursor:crosshair;
      transition:border-color .2s ease, box-shadow .2s ease;
      overflow:hidden;
    }
    .cell:focus-within{border-color:#2563eb; box-shadow:0 0 0 3px rgba(37,99,235,.2)}
    .cell canvas{
      width:100%;
      height:100%;
      border-radius:10px;
      border:1px dashed rgba(30,41,59,.15);
      background: repeating-linear-gradient(0deg, rgba(148,163,184,.18) 0 2px, transparent 2px 34px), #fff;
      touch-action:none;
    }
    .cell-hint{
      position:absolute;
      top:8px;
      left:12px;
      font-size:18px;
      font-weight:700;
      text-transform:uppercase;
      letter-spacing:.04em;
      color:rgba(15,23,42,.25);
      pointer-events:none;
    }
    .cell.focus-col{border-color:#2563eb; box-shadow:0 0 0 3px rgba(37,99,235,.18)}
    .cell.focus-col canvas{border-color:rgba(37,99,235,.35)}

    .legend{margin:10px 0 0; text-align:center; font-size:14px; color:#666}

    .sticky-actions{position:sticky; bottom:8px; display:flex; justify-content:center; gap:12px; margin-top:16px; flex-wrap:wrap}
    .sticky-actions button{min-width:clamp(150px, 30vw, 240px);}

    @media (max-width:720px){
      body{padding:14px}
      h1{font-size:22px}
      .cell{height:120px; padding:8px}
      .syllable{font-size:24px; padding:10px}
    }
  </style>
<style>
    .finish-bar { position: fixed; right: 16px; bottom: 16px; z-index: 1000; }
    #btnSelesai { background: #22c55e; color: #fff; border: none; cursor: pointer; padding: 12px 16px; border-radius: 12px; font-weight: 700; font-size: 16px; box-shadow: 0 6px 18px rgba(16, 185, 129, 0.4); }
    #btnSelesai:hover { filter: brightness(1.05); }
    #btnSelesai:active { transform: translateY(1px); }
    @media (max-width: 480px) {
      #btnSelesai { padding: 10px 14px; font-size: 15px; }
    }
  </style>

  <link rel="stylesheet" href="/elearn/worlds/calistung/buttons.css" />
</head>
<body class="alphabet-game" data-lesson-check="off">
  <div class="sheet" id="app">
    <h1>menulis suku kata</h1>

    <!-- HEADER SYLLABLES (click to select brush) -->
    <div class="headers" id="headers"></div>

    <!-- 4 x 5 grid cells -->
    <div class="grid" id="grid"></div>

    <div class="legend">Gunakan pensil digital atau mouse untuk <strong>menulis sendiri</strong> suku kata pada setiap kotak. Setiap kolom mengikuti suku kata pada header di atasnya (Shortcut: tekan angka 1–5 di keyboard untuk menyorot header).</div>

    <div class="sticky-actions">
      <button type="button" id="btnReset">Reset Tulisan</button>
      <button type="button" id="btnShuffle">Acak Urutan Kolom</button>
    </div>
  </div>

  <script>
    ;(() => {
      const headersEl = document.getElementById('headers');
      const gridEl = document.getElementById('grid');
      const btnReset = document.getElementById('btnReset');
      const btnShuffle = document.getElementById('btnShuffle');

      const base = ['ba', 'bi', 'bu', 'be', 'bo'];
      let order = [...base];
      const pads = [];

      function drawHeaders() {
        headersEl.innerHTML = '';
        order.forEach((syl, idx) => {
          const div = document.createElement('div');
          div.className = `syllable s-${syl}`;
          div.textContent = syl;
          div.dataset.index = String(idx);
          div.tabIndex = 0;
          div.addEventListener('click', () => setActive(div));
          div.addEventListener('keydown', (evt) => {
            if (evt.key === 'Enter' || evt.key === ' ') {
              evt.preventDefault();
              setActive(div);
            }
          });
          headersEl.appendChild(div);
        });
        setActive(headersEl.firstElementChild);
      }

      function setActive(element) {
        if (!element) {
          return;
        }
        [...headersEl.children].forEach((node) => node.classList.remove('active'));
        element.classList.add('active');
        highlightColumn(Number(element.dataset.index || 0));
      }

      function highlightColumn(index) {
        gridEl.querySelectorAll('.cell').forEach((cell) => {
          const col = Number(cell.dataset.colIndex || 0);
          if (col === index) {
            cell.classList.add('focus-col');
          } else {
            cell.classList.remove('focus-col');
          }
        });
      }

      function drawGrid() {
        gridEl.innerHTML = '';
        pads.length = 0;
        const rows = 4;
        const cols = order.length;
        for (let r = 0; r < rows; r += 1) {
          for (let c = 0; c < cols; c += 1) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.dataset.colIndex = String(c);
            const hint = document.createElement('span');
            hint.className = 'cell-hint';
            hint.textContent = order[c];
            cell.appendChild(hint);

            const canvas = document.createElement('canvas');
            canvas.className = 'cell-pad';
            canvas.setAttribute('aria-label', `Tulisan untuk kolom ${order[c]} baris ${r + 1}`);
            cell.appendChild(canvas);

            gridEl.appendChild(cell);
            pads.push(initCanvas(canvas));
          }
        }
        const activeEl = headersEl.querySelector('.active') || headersEl.firstElementChild;
        if (activeEl) {
          highlightColumn(Number(activeEl.dataset.index || 0));
        }
      }

      function shuffleOrder() {
        for (let i = order.length - 1; i > 0; i -= 1) {
          const j = Math.floor(Math.random() * (i + 1));
          [order[i], order[j]] = [order[j], order[i]];
        }
        drawHeaders();
        drawGrid();
        toast('Urutan kolom diacak ✨');
      }

      function resetAll() {
        pads.forEach((pad) => pad.clear());
        toast('Semua tulisan dibersihkan ✨');
      }

      function initCanvas(canvas) {
        const ctx = canvas.getContext('2d');
        const dpr = window.devicePixelRatio || 1;
        let drawing = false;
        let lastX = 0;
        let lastY = 0;

        const applyStyles = () => {
          ctx.setTransform(1, 0, 0, 1, 0, 0);
          ctx.scale(dpr, dpr);
          ctx.lineCap = 'round';
          ctx.lineJoin = 'round';
          ctx.lineWidth = 4;
          ctx.strokeStyle = '#1f2937';
        };

        const resize = (snapshot) => {
          const rect = canvas.getBoundingClientRect();
          const width = Math.max(rect.width, 120);
          const height = Math.max(rect.height, 90);
          canvas.width = Math.round(width * dpr);
          canvas.height = Math.round(height * dpr);
          applyStyles();
          ctx.clearRect(0, 0, width, height);
          if (snapshot && snapshot !== 'data:,') {
            const img = new Image();
            img.onload = () => ctx.drawImage(img, 0, 0, width, height);
            img.src = snapshot;
          }
        };

        const pointerPos = (evt) => {
          const rect = canvas.getBoundingClientRect();
          const point = evt.touches ? evt.touches[0] : evt;
          return {
            x: point.clientX - rect.left,
            y: point.clientY - rect.top
          };
        };

        const start = (evt) => {
          evt.preventDefault();
          const { x, y } = pointerPos(evt);
          drawing = true;
          lastX = x;
          lastY = y;
        };

        const move = (evt) => {
          if (!drawing) {
            return;
          }
          evt.preventDefault();
          const { x, y } = pointerPos(evt);
          ctx.beginPath();
          ctx.moveTo(lastX, lastY);
          ctx.lineTo(x, y);
          ctx.stroke();
          lastX = x;
          lastY = y;
        };

        const end = () => {
          drawing = false;
        };

        canvas.addEventListener('pointerdown', start);
        canvas.addEventListener('pointermove', move);
        canvas.addEventListener('pointerup', end);
        canvas.addEventListener('pointerleave', end);
        canvas.addEventListener('pointercancel', end);

        canvas.addEventListener('touchstart', start, { passive: false });
        canvas.addEventListener('touchmove', move, { passive: false });
        canvas.addEventListener('touchend', end);
        canvas.addEventListener('touchcancel', end);
        canvas.addEventListener('contextmenu', (evt) => evt.preventDefault());

        resize();

        const observer = new ResizeObserver(() => {
          const snapshot = canvas.toDataURL();
          resize(snapshot);
        });
        observer.observe(canvas);

        const clear = () => {
          const width = canvas.width / dpr;
          const height = canvas.height / dpr;
          ctx.clearRect(0, 0, width, height);
        };

        return { clear };
      }

      function toast(message) {
        const t = document.createElement('div');
        t.textContent = message;
        t.style.cssText = 'position:fixed;left:50%;bottom:18px;transform:translateX(-50%);background:#111;color:#fff;padding:10px 14px;border-radius:10px;box-shadow:0 8px 20px #0007;z-index:9999;font-weight:700;';
        document.body.appendChild(t);
        setTimeout(() => t.remove(), 2200);
      }

      drawHeaders();
      drawGrid();

      btnReset.addEventListener('click', resetAll);
      btnShuffle.addEventListener('click', shuffleOrder);

      window.addEventListener('keydown', (evt) => {
        const numeric = parseInt(evt.key, 10);
        if (!Number.isFinite(numeric)) {
          return;
        }
        const idx = numeric - 1;
        const target = headersEl.children[idx];
        if (target) {
          evt.preventDefault();
          setActive(target);
          target.focus();
        }
      });
    })();
  </script>
<div class="finish-bar"><button id="btnSelesai" type="button">Selesai</button></div>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="/elearn/manifest-lessons.js"></script>
<script src="/elearn/userInfo.js"></script>
<script src="/elearn/common/worksheet-submit.js"></script>
<script>
  window.WORKSHEET_DEBUG = true;
  const info = (typeof getUserInfo === "function") ? getUserInfo() : {};
  initWorksheetSubmit({
    muridUid: info.uid || "",
    cid: info.cid || "",
    namaAnak: info.nama || "",
    role: (info.role || "").toLowerCase()
  });
</script>
<script src="/elearn/common/calistung-navbar.js"></script>
</body>
</html>
