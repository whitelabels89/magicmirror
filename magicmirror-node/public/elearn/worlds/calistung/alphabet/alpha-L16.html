

<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>J3 – Memecahkan Kode</title>
  <link rel="stylesheet" href="theme.css" />
  <script defer src="theme.js"></script>
  <style>
    :root{
      --green:#45b058;
      --dark:#222;
      --gray:#e9eef3;
      --white:#fff;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: ui-rounded, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji"; color:var(--dark); background:#f8fafb;
    }
    header{
      padding:18px 16px; background:var(--green); color:white; text-align:center;
    }
    header h1{margin:0; font-size:clamp(22px,4vw,40px); letter-spacing:1px}
    header p{margin:.35rem 0 0; opacity:.95; font-weight:600}

    .container{max-width:1000px; margin:18px auto 64px; padding:0 16px}

    .key{
      width:100%; border-collapse:separate; border-spacing:0; overflow:hidden; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,.06); margin:8px 0 18px; background:white;
    }
    .key thead th{
      background:var(--green); color:white; padding:8px; font-size:14px;
    }
    .key td, .key th{ text-align:center; padding:8px 6px; }
    .key tbody tr:nth-child(odd) td{ background:#f5fbf6 }

    .row{ 
      display:grid; 
      grid-template-rows:56px 56px; /* baris 1 = soal angka, baris 2 = jawaban */
      grid-auto-flow: column;
      grid-auto-columns: minmax(48px,1fr);
      gap:8px; 
      align-items:stretch; 
      margin:18px 0; 
      overflow-x:auto; 
      padding-bottom:4px;
    }
    /* container angka & jawaban sekarang digabung dalam .row, kelas di bawah dipertahankan
       agar tidak mengganggu style box */
    .numbers, .inputs{ display:contents; }

    .numBox, .inBox{
      display:flex; align-items:center; justify-content:center; background:white; border:2px solid #d9e3ea; border-radius:8px; box-shadow:0 1px 3px rgba(0,0,0,.05);
      font-weight:700;
    }
    .numBox{ font-size:18px; }
    .inBox input{
      width:100%; height:100%; text-transform:uppercase; text-align:center; font-size:20px; font-weight:800; border:0; outline:0; background:transparent; letter-spacing:1px;
    }

    .controls{ display:flex; flex-wrap:wrap; gap:10px; margin:22px 0 8px }
    .btn{
      border:0; background:var(--dark); color:white; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:700; box-shadow:0 2px 6px rgba(0,0,0,.15);
    }
    .btn.secondary{ background:#4b5563 }
    .btn.success{ background:#1ea672 }
    .btn.warn{ background:#d97706 }

    .result{ margin-top:8px; font-weight:700 }
    .tag{display:inline-block; padding:4px 8px; border-radius:999px; font-size:12px; margin-left:8px}
    .tag.ok{ background:#e8fff5; color:#0f8b56; border:1px solid #b6f2d4 }
    .tag.no{ background:#fff3f0; color:#9a3412; border:1px solid #ffd5cc }

    .credit{opacity:.7; font-size:12px; text-align:center; margin-top:10px}

    @media (max-width:720px){
      .row{ grid-template-columns:1fr; }
    }
  </style>
<style>
    .finish-bar { position: fixed; right: 16px; bottom: 16px; z-index: 1000; }
    #btnSelesai { background: #22c55e; color: #fff; border: none; cursor: pointer; padding: 12px 16px; border-radius: 12px; font-weight: 700; font-size: 16px; box-shadow: 0 6px 18px rgba(16, 185, 129, 0.4); }
    #btnSelesai:hover { filter: brightness(1.05); }
    #btnSelesai:active { transform: translateY(1px); }
    @media (max-width: 480px) {
      #btnSelesai { padding: 10px 14px; font-size: 15px; }
    }
  </style>

  <link rel="stylesheet" href="/elearn/worlds/calistung/buttons.css" />
</head>
<body class="alphabet-game">
  <header>
    <h1>MEMECAHKAN KODE</h1>
    <p>Gunakan kunci di bawah ini untuk membantu memecahkan kodenya!</p>
  </header>

  <div class="container">
    <!-- Kunci huruf = angka -->
    <table class="key" aria-label="kunci huruf angka">
      <thead>
        <tr>
          <th colspan="13">a–m</th>
          <th colspan="13">n–z</th>
        </tr>
      </thead>
      <tbody>
        <tr id="row-letters-a"></tr>
        <tr id="row-numbers-a"></tr>
        <tr id="row-letters-n"></tr>
        <tr id="row-numbers-n"></tr>
      </tbody>
    </table>

    <div class="controls">
      <button class="btn" id="btnShuffle">Acak Soal</button>
      <button class="btn secondary" id="btnReset">Reset</button>
      <button class="btn success" id="btnCheck">Periksa Jawaban</button>
    </div>

    <div id="game"></div>

    <p class="credit">© Queen's Academy – J3</p>
  </div>

<div class="finish-bar"><button id="btnSelesai" type="button">Selesai</button></div>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="/elearn/manifest-lessons.js"></script>
<script src="/elearn/userInfo.js"></script>
<script src="/elearn/common/worksheet-submit.js"></script>
<script>
  window.WORKSHEET_DEBUG = true;
  const info = (typeof getUserInfo === "function") ? getUserInfo() : {};
  initWorksheetSubmit({
    muridUid: info.uid || "",
    cid: info.cid || "",
    namaAnak: info.nama || "",
    role: (info.role || "").toLowerCase()
  });
</script>
</script>
<script>
    (function(){
      // --- Utilities & State ---
      const A_CODE = 'A'.charCodeAt(0);
      const letters = Array.from({length:26}, (_,i)=>String.fromCharCode(A_CODE+i));
      const numbers = Array.from({length:26}, (_,i)=>i+1);

      const wordBank = [
        "KODING","ANAK","BELAJAR","ROBOT","ANGKA","HURUF",
        "WARNA","BUNGA","PESAWAT","PANTAI","BOLA","SEPEDA"
      ];

      const el = {
        keyRowLettersA: document.getElementById('row-letters-a'),
        keyRowNumbersA: document.getElementById('row-numbers-a'),
        keyRowLettersN: document.getElementById('row-letters-n'),
        keyRowNumbersN: document.getElementById('row-numbers-n'),
        game: document.getElementById('game'),
        btnShuffle: document.getElementById('btnShuffle'),
        btnReset: document.getElementById('btnReset'),
        btnCheck: document.getElementById('btnCheck'),
        container: document.querySelector('.container'),
      };

      // create status element (uses .result styles defined above)
      const statusEl = document.createElement('div');
      statusEl.id = 'status';
      statusEl.className = 'result';
      el.container.querySelector('.controls').after(statusEl);

      // --- Build Key Table (A=1...Z=26) ---
      function fillKey(){
        function cells(rangeStart, rangeEnd){
          const fragLetters = document.createDocumentFragment();
          const fragNumbers = document.createDocumentFragment();
          for(let i=rangeStart;i<=rangeEnd;i++){
            const tdL = document.createElement('td');
            tdL.textContent = letters[i-1].toLowerCase();
            fragLetters.appendChild(tdL);
            const tdN = document.createElement('td');
            tdN.textContent = i;
            fragNumbers.appendChild(tdN);
          }
          return [fragLetters, fragNumbers];
        }
        const [aL,aN] = cells(1,13);
        const [nL,nN] = cells(14,26);
        el.keyRowLettersA.innerHTML = ''; el.keyRowLettersA.appendChild(aL);
        el.keyRowNumbersA.innerHTML = ''; el.keyRowNumbersA.appendChild(aN);
        el.keyRowLettersN.innerHTML = ''; el.keyRowLettersN.appendChild(nL);
        el.keyRowNumbersN.innerHTML = ''; el.keyRowNumbersN.appendChild(nN);
      }

      // --- Encode word to numbers (A=1 ... Z=26) ---
      const encode = (w) => w.toUpperCase().replace(/[^A-Z]/g,'').split('').map(ch => ch.charCodeAt(0)-A_CODE+1);

      // --- DOM helpers for a single row (numbers + inputs) ---
      function buildRow(word, idx){
        const nums = encode(word);
        const row = document.createElement('div');
        row.className = 'row';
        row.dataset.word = word;

        // Numbers (top)
        nums.forEach(n => {
          const box = document.createElement('div');
          box.className = 'numBox';
          box.textContent = n;
          row.appendChild(box);
        });

        // Inputs (bottom)
        nums.forEach((_, i) => {
          const inWrap = document.createElement('div');
          inWrap.className = 'inBox';
          const input = document.createElement('input');
          input.setAttribute('maxlength','1');
          input.setAttribute('autocomplete','off');
          input.setAttribute('aria-label', `Huruf ke-${i+1} untuk soal ${idx+1}`);
          input.dataset.answer = word[i];
          input.addEventListener('input', (e) => {
            e.target.value = (e.target.value || '').toUpperCase().replace(/[^A-Z]/g,'');
            // auto advance
            if(e.target.value && input.nextElementSibling?.querySelector?.('input')){
              input.nextElementSibling.querySelector('input').focus();
            }
          });
          inWrap.appendChild(input);
          row.appendChild(inWrap);
        });

        return row;
      }

      function pickWords(count=6){
        const pool = [...wordBank];
        const out = [];
        while(out.length < count && pool.length){
          const i = Math.floor(Math.random()*pool.length);
          out.push(pool.splice(i,1)[0]);
        }
        return out;
      }

      function renderGame(){
        el.game.innerHTML = '';
        const words = pickWords();
        words.forEach((w, idx) => el.game.appendChild(buildRow(w, idx)));
        statusEl.textContent = 'Soal siap. Ketik huruf berdasarkan angka pada baris bawah.';
        // focus first input of first row for convenience
        el.game.querySelector('input')?.focus();
      }

      // --- Button handlers ---
      el.btnShuffle.addEventListener('click', () => { renderGame(); });
      el.btnReset.addEventListener('click', () => {
        el.game.querySelectorAll('input').forEach(i => { i.value=''; i.style.borderColor=''; });
        statusEl.textContent = 'Input dikosongkan.';
        el.game.querySelector('input')?.focus();
      });
      el.btnCheck.addEventListener('click', () => {
        let total = 0, benar = 0;
        el.game.querySelectorAll('.row').forEach(row => {
          const word = row.dataset.word;
          const inputs = Array.from(row.querySelectorAll('input'));
          const jawaban = inputs.map(i => (i.value || '').toUpperCase()).join('');
          total++;
          if(jawaban === word){
            benar++;
            inputs.forEach(i => i.style.borderColor = '#16a34a');
          }else{
            inputs.forEach((i,ix) => {
              const ok = (i.value || '').toUpperCase() === (i.dataset.answer || '');
              i.style.borderColor = ok ? '#16a34a' : '#dc2626';
            });
          }
        });
        statusEl.innerHTML = `Skor: ${benar} / ${total} <span class="tag ${benar===total?'ok':'no'}">${benar===total?'Semua benar':'Periksa lagi'}</span>`;
      });

      // Build key and initial game
      fillKey();
      renderGame();
    })();
  </script>
</body>
</html>