<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Alpha18 â€¢ Huruf yang Hilang</title>
  <link rel="stylesheet" href="theme.css" />
  <script defer src="theme.js"></script>
  <style>
    :root {
      --bg: #fffefb;
      --ink: #1f2937;
      --accent: #f97316;
      --card: #ffffff;
      --shadow: 0 18px 50px rgba(15, 23, 42, 0.12);
      --good: #22c55e;
      --bad: #ef4444;
      --muted: #6b7280;
    }
    *, *::before, *::after { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Poppins', system-ui, -apple-system, 'Segoe UI', sans-serif;
      background: radial-gradient(circle at top left, rgba(249, 115, 22, 0.08), transparent 55%), var(--bg);
      color: var(--ink);
      min-height: 100svh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: clamp(16px, 4vw, 36px);
    }
    .wrap {
      width: min(1100px, 100%);
      display: grid;
      gap: clamp(18px, 3.5vw, 28px);
    }
    .header {
      background: var(--card);
      border-radius: 28px;
      box-shadow: var(--shadow);
      padding: clamp(18px, 3.4vw, 28px);
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
      justify-content: space-between;
      align-items: center;
    }
    .header h1 {
      margin: 0;
      font-size: clamp(24px, 4.6vw, 38px);
      color: var(--accent);
      font-weight: 800;
    }
    .header p {
      margin: 4px 0 0;
      color: var(--muted);
      font-size: clamp(14px, 2.8vw, 16px);
      max-width: 520px;
      line-height: 1.5;
    }
    .game {
      background: var(--card);
      border-radius: 28px;
      box-shadow: var(--shadow);
      padding: clamp(18px, 3vw, 28px);
      display: grid;
      gap: clamp(16px, 3vw, 24px);
    }
    .bank-card {
      border: 1px solid rgba(15, 23, 42, 0.08);
      border-radius: 22px;
      padding: clamp(12px, 3vw, 18px);
      background: linear-gradient(180deg, rgba(249, 115, 22, 0.08), rgba(255, 255, 255, 0));
    }
    .bank-title {
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: .4px;
      color: rgba(249, 115, 22, 0.85);
      margin-bottom: 10px;
    }
    .bank {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      touch-action: none;
    }
    .tile {
      width: 60px;
      height: 60px;
      border-radius: 18px;
      background: #fff2e5;
      border: 3px solid rgba(249, 115, 22, 0.25);
      display: grid;
      place-items: center;
      font-size: 24px;
      font-weight: 800;
      color: var(--accent);
      cursor: grab;
      user-select: none;
      position: relative;
      transition: transform .08s ease;
      touch-action: none;
    }
    .tile:active { cursor: grabbing; }
    .tile.floating {
      position: fixed;
      z-index: 1000;
      pointer-events: none;
      transform: translate(-50%, -50%) scale(1.08);
      box-shadow: 0 12px 30px rgba(249, 115, 22, 0.4);
    }
    .tile.home-slot { background: #fef3c7; }

    .grid {
      display: grid;
      gap: clamp(12px, 2.6vw, 20px);
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }
    .card {
      border: 1px solid rgba(15, 23, 42, 0.08);
      border-radius: 22px;
      padding: clamp(14px, 3vw, 20px);
      display: grid;
      grid-template-columns: 72px 1fr;
      gap: 14px;
      align-items: center;
      background: linear-gradient(135deg, #fff, rgba(255, 243, 224, 0.65));
    }
    .card .icon {
      width: 64px;
      height: 64px;
      border-radius: 18px;
      display: grid;
      place-items: center;
      font-size: 36px;
      background: #fff7ed;
      border: 2px solid rgba(249, 115, 22, 0.18);
    }
    .word {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 22px;
      font-weight: 700;
    }
    .slot {
      width: 64px;
      height: 60px;
      border-radius: 18px;
      border: 3px dashed rgba(15, 23, 42, 0.16);
      background: #ffffff;
      display: grid;
      place-items: center;
      position: relative;
      overflow: hidden;
      touch-action: none;
    }
    .slot.filled {
      border-style: solid;
      border-color: rgba(249, 115, 22, 0.5);
      background: #fff7ed;
    }
    .card.ok .slot { border-color: var(--good); background: #ecfdf5; }
    .card.no .slot { border-color: var(--bad); background: #fef2f2; }

    .foot {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: space-between;
      align-items: center;
    }
    .actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .btn {
      border: none;
      border-radius: 999px;
      padding: 12px 18px;
      font-weight: 800;
      cursor: pointer;
      transition: transform .06s ease;
      color: #fff;
      background: var(--accent);
      box-shadow: 0 6px 0 #c2410c;
    }
    .btn:hover { transform: translateY(-1px); }
    .btn:active { transform: translateY(2px); }
    .btn.secondary {
      background: #111827;
      box-shadow: 0 6px 0 #000;
    }
    .btn.ghost {
      background: #e5e7eb;
      color: #1f2937;
      box-shadow: none;
    }
    .score {
      font-weight: 700;
      font-size: 18px;
    }
    .note {
      color: var(--muted);
      font-size: 13px;
    }

    @media (max-width: 640px) {
      .card { grid-template-columns: 56px 1fr; }
      .card .icon { width: 52px; height: 52px; font-size: 30px; }
      .slot { width: 56px; height: 54px; }
      .tile { width: 54px; height: 54px; }
    }
  </style>
  <style>
    .finish-bar { position: fixed; right: 16px; bottom: 16px; z-index: 1000; }
    #btnSelesai { background: #22c55e; color: #fff; border: none; cursor: pointer; padding: 12px 16px; border-radius: 12px; font-weight: 700; font-size: 16px; box-shadow: 0 6px 18px rgba(16, 185, 129, 0.4); }
    #btnSelesai:hover { filter: brightness(1.05); }
    #btnSelesai:active { transform: translateY(1px); }
    @media (max-width: 480px) {
      #btnSelesai { padding: 10px 14px; font-size: 15px; }
    }
  </style>
  <link rel="stylesheet" href="/elearn/worlds/calistung/buttons.css" />
</head>
<body class="alphabet-game">
  <div class="wrap">
    <section class="header">
      <div>
        <h1>Huruf yang Hilang</h1>
        <p>Seret huruf pertama dari bank ke kotak kosong agar kata sesuai dengan gambarnya. Huruf akan kembali ke tempat asal jika dijatuhkan di luar kotak.</p>
      </div>
      <span class="note">Level: Alpha18L8</span>
    </section>

    <section class="game" aria-live="polite">
      <div class="bank-card">
        <div class="bank-title">Bank Huruf</div>
        <div id="bank" class="bank" aria-label="Bank huruf"></div>
      </div>

      <div id="grid" class="grid"></div>

      <div class="foot">
        <span id="score" class="score">Skor: 0/12</span>
        <div class="actions">
          <button type="button" class="btn ghost" id="btnReset">Reset</button>
          <button type="button" class="btn secondary" id="btnShuffle">Acak Soal</button>
          <button type="button" class="btn" id="btnCheck">Periksa Jawaban</button>
        </div>
      </div>
    </section>
  </div>

  <div class="finish-bar"><button id="btnSelesai" type="button">Selesai</button></div>

  <script>
    (function(){
      const DATA = [
        { icon: 'ðŸŽ', word: 'apel' },
        { icon: 'ðŸšŒ', word: 'bis' },
        { icon: 'ðŸ¦Ž', word: 'cicak' },
        { icon: 'ðŸŽ²', word: 'dadu' },
        { icon: 'ðŸ¦…', word: 'elang' },
        { icon: 'ðŸ–¼ï¸', word: 'foto' },
        { icon: 'ðŸ˜', word: 'gajah' },
        { icon: 'â›‘ï¸', word: 'helm' },
        { icon: 'ðŸ ', word: 'ikan' },
        { icon: 'ðŸ§ƒ', word: 'jus' },
        { icon: 'ðŸ¸', word: 'katak' },
        { icon: 'ðŸ', word: 'lebah' }
      ];

      const bankEl = document.getElementById('bank');
      const gridEl = document.getElementById('grid');
      const scoreEl = document.getElementById('score');
      const btnCheck = document.getElementById('btnCheck');
      const btnReset = document.getElementById('btnReset');
      const btnShuffle = document.getElementById('btnShuffle');

      let cards = [];
      let tiles = [];
      let dragState = null;

      function init(){
        render(shuffle([...DATA]));
        attachEvents();
      }

      function render(data){
        gridEl.innerHTML = '';
        bankEl.innerHTML = '';
        cards = [];
        tiles = [];

        data.forEach(item => {
          const card = document.createElement('article');
          card.className = 'card';
          card.dataset.answer = item.word[0];

          const icon = document.createElement('div');
          icon.className = 'icon';
          icon.textContent = item.icon;

          const wordWrap = document.createElement('div');
          wordWrap.className = 'word';
          const slot = document.createElement('div');
          slot.className = 'slot';
          slot.dataset.accept = item.word[0];
          const rest = document.createElement('span');
          rest.textContent = item.word.slice(1);
          wordWrap.append(slot, rest);

          card.append(icon, wordWrap);
          gridEl.appendChild(card);
          cards.push({ element: card, slot, answer: item.word[0] });
        });

        const letters = data.map(item => item.word[0].toLowerCase());
        shuffle(letters).forEach(letter => {
          const tile = document.createElement('div');
          tile.className = 'tile';
          tile.textContent = letter.toUpperCase();
          tile.dataset.letter = letter;
          tile.dataset.home = 'bank';
          bankEl.appendChild(tile);
          initTile(tile);
          tiles.push(tile);
        });

        updateScore();
      }

      function initTile(tile){
        tile.addEventListener('pointerdown', startDrag);
      }

      function startDrag(event){
        event.preventDefault();
        const tile = event.currentTarget;
        const rect = tile.getBoundingClientRect();
        const ghost = tile.cloneNode(true);
        ghost.classList.add('floating');
        document.body.appendChild(ghost);
        positionGhost(ghost, event.clientX, event.clientY);

        tile.classList.add('drag-source');
        tile.style.visibility = 'hidden';

        dragState = {
          tile,
          ghost,
          origin: tile.parentElement,
          pointerId: event.pointerId
        };

        tile.setPointerCapture(event.pointerId);
        tile.addEventListener('pointermove', onPointerMove);
        tile.addEventListener('pointerup', endDrag);
        tile.addEventListener('pointercancel', cancelDrag);
      }

      function onPointerMove(event){
        if(!dragState) return;
        positionGhost(dragState.ghost, event.clientX, event.clientY);
      }

      function endDrag(event){
        if(!dragState) return;
        const { tile, ghost, origin } = dragState;
        const dropTarget = document.elementFromPoint(event.clientX, event.clientY);
        finishPointer(tile);

        const bankTarget = dropTarget?.closest('.bank');
        const originWasSlot = origin.classList?.contains('slot');

        if(dropTarget && dropTarget.classList.contains('slot')){
          if(originWasSlot && dropTarget !== origin){
            origin.classList.remove('filled');
          }
          placeTile(tile, dropTarget);
        } else if(dropTarget && dropTarget.classList.contains('tile') && dropTarget.parentElement?.classList.contains('slot')){
          if(originWasSlot && dropTarget.parentElement !== origin){
            origin.classList.remove('filled');
          }
          placeTile(tile, dropTarget.parentElement);
        } else if(bankTarget){
          if(originWasSlot){
            origin.classList.remove('filled');
          }
          bankEl.appendChild(tile);
        } else {
          origin.appendChild(tile);
          if(origin.classList.contains('slot')){
            origin.classList.add('filled');
          }
        }

        ghost.remove();
        tile.style.visibility = '';
        tile.classList.remove('drag-source');
        dragState = null;
      }

      function cancelDrag(){
        if(!dragState) return;
        const { tile, ghost, origin } = dragState;
        finishPointer(tile);
        origin.appendChild(tile);
        ghost.remove();
        tile.style.visibility = '';
        tile.classList.remove('drag-source');
        dragState = null;
      }

      function finishPointer(tile){
        tile.releasePointerCapture(dragState.pointerId);
        tile.removeEventListener('pointermove', onPointerMove);
        tile.removeEventListener('pointerup', endDrag);
        tile.removeEventListener('pointercancel', cancelDrag);
      }

      function positionGhost(ghost, x, y){
        ghost.style.left = `${x}px`;
        ghost.style.top = `${y}px`;
      }

      function placeTile(tile, slot){
        if(slot.firstElementChild){
          bankEl.appendChild(slot.firstElementChild);
          slot.classList.remove('filled');
        }
        slot.appendChild(tile);
        slot.classList.add('filled');
        updateScore();
      }

      function updateScore(){
        let correct = 0;
        cards.forEach(card => {
          const tile = card.slot.querySelector('.tile');
          card.element.classList.remove('ok', 'no');
          if(tile){
            if(tile.dataset.letter === card.answer){
              correct++;
            }
          }
        });
        scoreEl.textContent = `Skor: ${correct}/${cards.length}`;
      }

      function checkAnswers(){
        let correct = 0;
        cards.forEach(card => {
          const tile = card.slot.querySelector('.tile');
          card.element.classList.remove('ok', 'no');
          if(tile && tile.dataset.letter === card.answer){
            card.element.classList.add('ok');
            correct++;
          } else {
            card.element.classList.add('no');
          }
        });
        scoreEl.textContent = `Skor: ${correct}/${cards.length}`;
      }

      function resetBoard(){
        tiles.forEach(tile => {
          bankEl.appendChild(tile);
          tile.style.visibility = '';
        });
        gridEl.querySelectorAll('.slot').forEach(slot => slot.classList.remove('filled'));
        cards.forEach(card => card.element.classList.remove('ok', 'no'));
        updateScore();
      }

      function shuffleBoard(){
        render(shuffle([...DATA]));
      }

      function attachEvents(){
        btnCheck.addEventListener('click', checkAnswers);
        btnReset.addEventListener('click', resetBoard);
        btnShuffle.addEventListener('click', () => {
          shuffleBoard();
        });
      }

      function shuffle(arr){
        for(let i = arr.length - 1; i > 0; i--){
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      init();
    })();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="/elearn/manifest-lessons.js"></script>
  <script src="/elearn/userInfo.js"></script>
  <script src="/elearn/common/worksheet-submit.js"></script>
  <script>
    window.WORKSHEET_DEBUG = true;
    const info = (typeof getUserInfo === "function") ? getUserInfo() : {};
    initWorksheetSubmit({
      muridUid: info.uid || "",
      cid: info.cid || "",
      namaAnak: info.nama || "",
      role: (info.role || "").toLowerCase()
    });
  </script>
  <script src="/elearn/common/calistung-navbar.js"></script>
</body>
</html>
