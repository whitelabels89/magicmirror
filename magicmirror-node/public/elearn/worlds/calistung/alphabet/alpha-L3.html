<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Alpha3 – Pasangkan Huruf Awal</title>
  <style>
    :root{
      --bg:#f7fbff; --ink:#253b52; --accent:#2e90fa; --ok:#2fbf71; --bad:#ff5a5f;
    }
    html,body{height:100%;margin:0;font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji"; color:var(--ink); background:var(--bg);}    
    .wrap{max-width:1000px;margin:0 auto; padding:16px; display:flex; flex-direction:column; gap:12px;}
    header{display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap}
    h1{font-size:18px; margin:0; font-weight:700}
    .hint{font-size:14px; opacity:.9}
    .board{position:relative; background:#fff; border:2px solid #cfe3ff; border-radius:16px; padding:12px; display:grid; grid-template-columns:1fr; gap:12px; min-height:520px}

    /* Left (huruf) + right (gambar) columns */
    .cols{display:grid; grid-template-columns:1fr 1fr; gap:8px; align-items:stretch;}
    .col{display:flex; flex-direction:column; gap:18px; justify-content:space-evenly;}

    .node{display:flex; align-items:center; gap:10px;}
    .letter{width:56px; height:56px; display:grid; place-items:center; font-weight:800; font-size:40px; color:var(--ink)}
    .dot{width:16px; height:16px; border-radius:50%; background:#5a7a9c; cursor:pointer; position:relative; outline:0; border:2px solid transparent}
    .dot:focus{border-color:#9dc3ff}

    .card{display:flex; align-items:center; gap:10px;}
    .imgLabel{min-width:56px; height:56px; display:grid; place-items:center; font-size:40px}
    .caption{font-size:16px; font-weight:600}

    svg.wires{position:absolute; inset:0; width:100%; height:100%; overflow:visible; pointer-events:none}

    .tools{display:flex; gap:8px; flex-wrap:wrap}
    .btn{padding:10px 14px; border-radius:10px; border:0; background:var(--accent); color:#fff; font-weight:700; cursor:pointer}
    .btn.ghost{background:#e9f2ff; color:var(--ink)}
    .btn.warning{background:#ffd5d5; color:#8a0f0f}

    .status{min-height:20px; font-weight:700}

    /* Mobile */
    @media (max-width: 720px){
      .board{min-height:580px}
      .letter{width:48px;height:48px;font-size:34px}
      .imgLabel{width:48px;height:48px;font-size:34px}
      .caption{font-size:14px}
      .cols{gap:4px}
    }
  </style>
<style>
    .finish-bar { position: fixed; right: 16px; bottom: 16px; z-index: 1000; }
    #btnSelesai { background: #22c55e; color: #fff; border: none; cursor: pointer; padding: 12px 16px; border-radius: 12px; font-weight: 700; font-size: 16px; box-shadow: 0 6px 18px rgba(16, 185, 129, 0.4); }
    #btnSelesai:hover { filter: brightness(1.05); }
    #btnSelesai:active { transform: translateY(1px); }
    @media (max-width: 480px) {
      #btnSelesai { padding: 10px 14px; font-size: 15px; }
    }
  </style>

  <link rel="stylesheet" href="/elearn/worlds/calistung/buttons.css" />
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Pasangkan huruf awal dari setiap benda</h1>
        <div class="hint">Klik titik di kiri lalu klik titik di kanan untuk menggambar garis. Cocokkan a-i-u-e-o dengan gambar.</div>
      </div>
      <div class="tools">
        <button class="btn" id="checkBtn">Periksa Jawaban</button>
        <button class="btn ghost" id="shuffleBtn">Acak Soal</button>
        <button class="btn ghost" id="resetBtn">Reset Jawaban</button>
      </div>
    </header>

    <section class="board" id="board">
      <svg class="wires" id="wires"></svg>
      <div class="cols">
        <div class="col" id="leftCol">
          <!-- left nodes (letters) generated by JS -->
        </div>
        <div class="col" id="rightCol">
          <!-- right nodes (images/labels) generated by JS -->
        </div>
      </div>
    </section>

    <div class="status" id="status"></div>
  </div>

<script>
(function(){
  const letters = [
    {key:'a', label:'a'},
    {key:'i', label:'i'},
    {key:'u', label:'u'},
    {key:'e', label:'e'},
    {key:'o', label:'o'}
  ];

  // Pilihan berganda per huruf supaya acak lebih variatif
  const pools = {
    a: [
      { id:'apel',  icon:'🍎' },
      { id:'ayam',  icon:'🐔' }
    ],
    i: [
      { id:'ikan',  icon:'🐟' }
    ],
    u: [
      { id:'uang',  icon:'💵' },
      { id:'udang', icon:'🦐' }
    ],
    e: [
      { id:'ember',  icon:'🪣' },
      { id:'eskrim', icon:'🍦' }
    ],
    o: [
      { id:'obat', icon:'💊' }
    ]
  };

  const leftCol = document.getElementById('leftCol');
  const rightCol = document.getElementById('rightCol');
  const wiresSvg = document.getElementById('wires');
  const statusBox = document.getElementById('status');

  let items = [];
  let connections = {}; // map rightIndex -> leftIndex
  let pendingLeft = null; // index of selected left dot

  function shuffle(arr){
    for(let i=arr.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [arr[i],arr[j]]=[arr[j],arr[i]];
    }
    return arr;
  }

  function build(){
    // reset
    leftCol.innerHTML = '';
    rightCol.innerHTML = '';
    wiresSvg.innerHTML = '';
    connections = {};
    pendingLeft = null;

    // pilih satu item acak dari setiap huruf (a,i,u,e,o), lalu acak posisi kolom kanan
    const picked = [];
    letters.forEach(L => {
      const options = pools[L.key] || [];
      if(options.length){
        const choice = options[Math.floor(Math.random()*options.length)];
        picked.push({ ...choice, answer: L.key });
      }
    });
    items = shuffle(picked);

    // left
    letters.forEach((L, li)=>{
      const row = document.createElement('div'); row.className = 'node';
      row.dataset.type='left'; row.dataset.index=li;

      const span = document.createElement('div'); span.className = 'letter'; span.textContent = L.label;
      const dot = document.createElement('button'); dot.className='dot'; dot.title = 'Pilih huruf \''+L.label+'\''; dot.setAttribute('aria-label','dot-left-'+li);

      dot.addEventListener('click', ()=>{
        pendingLeft = li; // mark selection
        document.querySelectorAll('.dot').forEach(d=>d.style.outline='');
        dot.style.outline = '3px solid var(--accent)';
      });

      row.appendChild(span); row.appendChild(dot);
      leftCol.appendChild(row);
    });

    // right
    items.forEach((it, ri)=>{
      const row = document.createElement('div'); row.className = 'card'; row.dataset.type='right'; row.dataset.index=ri;
      const dot = document.createElement('button'); dot.className='dot'; dot.title = 'Hubungkan ke gambar'; dot.setAttribute('aria-label','dot-right-'+ri);
      const fig = document.createElement('div'); fig.className='imgLabel'; fig.textContent = it.icon;
      const cap = document.createElement('div'); cap.className='caption'; cap.textContent = it.text;

      dot.addEventListener('click', ()=>{
        if(pendingLeft===null){
          // nothing chosen yet; flash
          flashStatus('Pilih titik huruf di kiri dulu.', true);
          return;
        }
        // create/replace connection to this right node
        connections[ri] = pendingLeft; // overwrite allowed
        pendingLeft = null;
        document.querySelectorAll('.dot').forEach(d=>d.style.outline='');
        drawLines();
      });

      row.appendChild(dot); row.appendChild(fig); row.appendChild(cap);
      rightCol.appendChild(row);
    });

    // draw initial
    requestAnimationFrame(drawLines);
  }

  function getDotCenter(el){
    const r = el.getBoundingClientRect();
    const b = wiresSvg.getBoundingClientRect();
    return { x: r.left + r.width/2 - b.left, y: r.top + r.height/2 - b.top };
  }

  function drawLines(){
    wiresSvg.innerHTML = '';
    Object.entries(connections).forEach(([ri, li])=>{
      const leftDot = leftCol.querySelector(`.node[data-index="${li}"] .dot`);
      const rightDot = rightCol.querySelector(`.card[data-index="${ri}"] .dot`);
      if(!leftDot || !rightDot) return;
      const a = getDotCenter(leftDot);
      const b = getDotCenter(rightDot);
      const path = document.createElementNS('http://www.w3.org/2000/svg','path');
      const d = `M ${a.x} ${a.y} C ${(a.x+b.x)/2} ${a.y}, ${(a.x+b.x)/2} ${b.y}, ${b.x} ${b.y}`;
      path.setAttribute('d', d);
      path.setAttribute('fill','none');
      path.setAttribute('stroke','var(--accent)');
      path.setAttribute('stroke-width','4');
      path.setAttribute('stroke-linecap','round');
      wiresSvg.appendChild(path);
    });
  }

  function check(){
    let correct=0, total=items.length;
    items.forEach((it, ri)=>{
      const li = connections[ri];
      const ansLetter = letters[li]?.key;
      const ok = ansLetter === it.answer;
      if(ok) correct++;
      const row = rightCol.querySelector(`.card[data-index="${ri}"]`);
      row.style.background = ok? 'rgba(47,191,113,.12)' : (li==null? 'transparent' : 'rgba(255,90,95,.12)');
    });
    if(correct===total){
      flashStatus('Mantap! Semua benar 🎉', false);
    }else{
      flashStatus(`${correct}/${total} benar. Coba lagi ya.`, true);
    }
  }

  function resetAnswers(){
    connections = {}; drawLines();
    rightCol.querySelectorAll('.card').forEach(c=>c.style.background='transparent');
    flashStatus('Jawaban direset. Sambungkan lagi.', false);
  }

  function flashStatus(msg, warn){
    statusBox.textContent = msg;
    statusBox.style.color = warn? 'var(--bad)' : 'var(--ok)';
  }

  // Buttons
  document.getElementById('checkBtn').addEventListener('click', check);
  document.getElementById('shuffleBtn').addEventListener('click', ()=>{ build(); flashStatus('Soal diacak ulang.', false); });
  document.getElementById('resetBtn').addEventListener('click', resetAnswers);

  // Re-draw on resize/zoom so lines stick to dots
  window.addEventListener('resize', ()=> requestAnimationFrame(drawLines));

  build();
})();
</script>
<div class="finish-bar"><button id="btnSelesai" type="button">Selesai</button></div>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="/elearn/manifest-lessons.js"></script>
<script src="/elearn/userInfo.js"></script>
<script src="/elearn/common/worksheet-submit.js"></script>
<script>
  window.WORKSHEET_DEBUG = true;
  const info = (typeof getUserInfo === "function") ? getUserInfo() : {};
  initWorksheetSubmit({
    muridUid: info.uid || "",
    cid: info.cid || "",
    namaAnak: info.nama || "",
    role: (info.role || "").toLowerCase()
  });
</script>
</body>
</html>