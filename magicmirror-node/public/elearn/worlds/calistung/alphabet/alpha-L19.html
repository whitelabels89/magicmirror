<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <title>ALPHA19 â€¢ L8 â€“ Menyusun Kata (Unscramble)</title>
  <link rel="stylesheet" href="theme.css" />
  <script defer src="theme.js"></script>
  <style>
    :root{
      --bg:#f7f8ff; --ink:#1e1f2e; --muted:#6b6f85; --brand:#6a8dff; --ok:#27ae60; --no:#e74c3c; --panel:#ffffff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family: system-ui,-apple-system, Segoe UI, Roboto, Noto Sans, Ubuntu, "Helvetica Neue", Arial; color:var(--ink); background:linear-gradient(180deg,#eef2ff, #fdfbff 60%);}    
    .wrap{min-height:100%; display:flex; flex-direction:column}

    header{position:sticky; top:0; z-index:50; backdrop-filter:saturate(1.2) blur(6px); background:rgba(255,255,255,.85); border-bottom:1px solid #e8e8f3}
    .bar{display:flex; align-items:center; gap:.75rem; padding:.6rem .9rem}
    .brand{font-weight:800; letter-spacing:.5px}
    .pill{margin-left:auto; font-size:.85rem; color:var(--muted)}

    main{width:min(1000px, 94vw); margin:1rem auto; padding-bottom:82px}
    h2{margin:.2rem 0 .4rem}
    .hint{font-size:12px; color:var(--muted)}

    .deck{display:grid; grid-template-columns:repeat(2,1fr); gap:14px; margin-top:.8rem}
    @media (max-width:768px){ .deck{grid-template-columns:1fr} }

    .card{background:var(--panel); border:1px solid #ececf6; border-radius:14px; padding:14px 14px 12px; display:grid; grid-template-columns:56px 1fr; gap:12px; align-items:center; box-shadow:0 3px 0 rgba(106,141,255,.06)}
    .card.ok{border-color:#cdefd8}
    .card.no{border-color:#ffd5d0}

    .emj{font-size:36px; text-align:center}
    .qtext{line-height:1.25}

    .row{display:flex; align-items:center; gap:10px; flex-wrap:wrap}

    /* tiles (huruf acak) */
    .tiles{display:flex; gap:8px; flex-wrap:wrap; touch-action:none}
    .tile{flex:0 0 auto; width:42px; height:42px; display:grid; place-items:center; border-radius:10px; background:#fff; border:2px solid #e7e9fb; box-shadow:0 1px 0 rgba(0,0,0,.04); font-weight:800; font-size:18px; user-select:none; cursor:grab; touch-action:none}
    .tile:active{cursor:grabbing; transform:scale(.98)}

    /* slots (jawaban) */
    .slots{display:flex; gap:8px; touch-action:none}
    .slot{width:46px; height:46px; border-radius:10px; border:2px dashed #cfd3ff; background:#f7f8ff; display:grid; place-items:center}
    .slot.filled{border-style:solid; border-color:#aab1ff; background:#fff}

    .status{margin-top:12px; font-weight:700}
    .status.ok{color:var(--ok)}
    .status.no{color:var(--no)}

    .actions{position:fixed; inset:auto 0 10px 0; display:flex; gap:10px; justify-content:center; z-index:60}
    .btn{border:none; padding:12px 16px; border-radius:12px; background:var(--brand); color:#fff; font-weight:800; letter-spacing:.3px; cursor:pointer; box-shadow:0 6px 16px rgba(106,141,255,.35)}
    .btn.secondary{background:#fff; color:var(--ink); border:1px solid #eaeaf5; box-shadow:0 4px 12px rgba(0,0,0,.07)}
    .btn.ghost{background:transparent; border:1px dashed #d9dcff; color:var(--muted)}
    .footer-note{margin-top:10px; font-size:11px; color:#8a8ead; text-align:center}
  </style>
<style>
    .finish-bar { position: fixed; right: 16px; bottom: 16px; z-index: 1000; }
    #btnSelesai { background: #22c55e; color: #fff; border: none; cursor: pointer; padding: 12px 16px; border-radius: 12px; font-weight: 700; font-size: 16px; box-shadow: 0 6px 18px rgba(16, 185, 129, 0.4); }
    #btnSelesai:hover { filter: brightness(1.05); }
    #btnSelesai:active { transform: translateY(1px); }
    @media (max-width: 480px) {
      #btnSelesai { padding: 10px 14px; font-size: 15px; }
    }
  </style>

  <link rel="stylesheet" href="/elearn/worlds/calistung/buttons.css" />
</head>
<body class="alphabet-game">
<div class="wrap">
  <header>
    <div class="bar">
      <div class="brand">ALPHA19 Â· Level 8 â€” Menyusun Kata</div>
      <div class="pill" id="scorePill">Skor: 0</div>
    </div>
  </header>

  <main>
    <h2>Susun Huruf Jadi Kata yang Tepat âœ¨</h2>
    <div class="hint">Seret huruf <b>dari baris acak</b> ke kotak jawaban. Bisa ditarik balik kalau salah. Soal diacak tiap refresh.</div>

    <div class="deck" id="deck"></div>
    <div class="status" id="status"></div>
    <div class="footer-note">Â© Queen's Academy â€“ ALPHA19L8A</div>
  </main>

  <div class="actions">
    <button class="btn secondary" id="btnShuffle">Acak Soal</button>
    <button class="btn" id="btnCheck">Periksa Jawaban</button>
    <button class="btn ghost" id="btnReset">Reset</button>
  </div>
</div>

<script>
(()=>{
  // --- DATA (mengikuti worksheet contoh) --------------------------------
  const BANK = [
    {emoji:'ðŸŽ', word:'apel'},
    {emoji:'ðŸ“š', word:'buku'},
    {emoji:'âš½', word:'bola'},
    {emoji:'ðŸž', word:'roti'},
    {emoji:'ðŸ‘•', word:'baju'},
    {emoji:'ðŸ›ï¸', word:'kasur'},
    // ekstra variasi bila diperlukan selanjutnya
    {emoji:'ðŸ¦†', word:'bebek'},
    {emoji:'â­', word:'bintang'},
    {emoji:'ðŸ§¸', word:'boneka'},
    {emoji:'ðŸ½ï¸', word:'meja'}
  ];

  const deckEl = document.getElementById('deck');
  const statusEl = document.getElementById('status');
  const scorePill = document.getElementById('scorePill');
  const btnCheck = document.getElementById('btnCheck');
  const btnReset = document.getElementById('btnReset');
  const btnShuffle = document.getElementById('btnShuffle');

  const LS_KEY = 'qa_alpha19L8a_score';
  let score = Number(localStorage.getItem(LS_KEY) || 0);
  updateScore(0);

  let cards = [];
  function newRound(){
    statusEl.textContent='';
    deckEl.innerHTML='';
    // Pilih 5 soal acak supaya mirip worksheet
    const pick = shuffle([...BANK]).slice(0,5);
    cards = pick.map((it,idx)=>({id:`c${idx}`, ...it}));
    cards.forEach(renderCard);
  }

  function renderCard(c){
    const card = document.createElement('div');
    card.className = 'card';
    card.dataset.word = c.word;
    card.dataset.id = c.id;

    const scrambled = scramble(c.word);

    card.innerHTML = `
      <div class="emj" aria-hidden="true">${c.emoji}</div>
      <div class="qtext">
        <div class="row tiles" data-area="tiles"></div>
        <div class="row slots" data-area="slots"></div>
      </div>`;

    const tilesEl = card.querySelector('[data-area="tiles"]');
    const slotsEl = card.querySelector('[data-area="slots"]');

    // build tiles (huruf acak)
    for(const ch of scrambled){
      const t = document.createElement('div');
      t.className = 'tile';
      t.textContent = ch.toUpperCase();
      t.setAttribute('draggable','true');
      t.addEventListener('dragstart', onDragStart);
      t.addEventListener('touchstart', onTouchDragStart, {passive:false});
      tilesEl.appendChild(t);
    }

    // build slots (jawaban)
    for(let i=0;i<c.word.length;i++){
      const s = document.createElement('div');
      s.className = 'slot';
      s.ondragover = (e)=>e.preventDefault();
      s.ondrop = (e)=>onDrop(e, s);
      // agar bisa balikin huruf dari slot ke slot lain/pool
      s.addEventListener('touchstart', e=>e.preventDefault());
      slotsEl.appendChild(s);
    }

    deckEl.appendChild(card);
  }

  // --- DRAG & DROP (DOM move) ------------------------------------------
  function onDragStart(ev){
    ev.dataTransfer.setData('text/plain', 'drag');
    ev.dataTransfer.effectAllowed = 'move';
    // tandai elemen yang diseret
    dragged = ev.target;
    const originSlot = dragged.parentElement;
    if(originSlot && originSlot.classList && originSlot.classList.contains('slot')){
      originSlot.classList.remove('filled');
      originSlot.style.borderColor = '#cfd3ff';
      originSlot.style.background = '#f7f8ff';
    }
  }
  let dragged = null;
  function onDrop(ev, slot){
    ev.preventDefault();
    if(!dragged) return;
    // jika slot sudah berisi, kembalikan anak ke pool terdekat
    if(slot.firstElementChild){
      const old = slot.firstElementChild;
      const pool = closestTiles(slot);
      pool.appendChild(old);
    }
    // pindahkan huruf
    slot.appendChild(dragged);
    slot.classList.add('filled');
    dragged = null;
  }

  function closestTiles(el){
    const card = el.closest('.card');
    return card.querySelector('[data-area="tiles"]');
  }

  // --- TOUCH (sederhana) -----------------------------------------------
  function onTouchDragStart(e){
    e.preventDefault();
    const tile = e.currentTarget;
    const origin = tile.parentElement;
    if(origin && origin.classList && origin.classList.contains('slot')){
      origin.classList.remove('filled');
      origin.style.borderColor = '#cfd3ff';
      origin.style.background = '#f7f8ff';
    }
    tile.style.outline = '2px solid #aab1ff';
    let hoverSlot = null;

    const move = (ev)=>{
      ev.preventDefault();
      const t = ev.touches[0];
      const el = document.elementFromPoint(t.clientX, t.clientY);
      if(hoverSlot && el !== hoverSlot){
        hoverSlot.style.transform = '';
        hoverSlot = null;
      }
      if(el && el.classList && el.classList.contains('slot')){
        hoverSlot = el;
        hoverSlot.style.transform = 'scale(1.05)';
      }
    };

    const finish = (ev)=>{
      ev.preventDefault();
      tile.style.outline='';
      if(hoverSlot){
        hoverSlot.style.transform='';
      }
      const touch = (ev.changedTouches||ev.touches)[0];
      const el = document.elementFromPoint(touch.clientX, touch.clientY);
      if(el && el.classList && el.classList.contains('slot')){
        if(el.firstElementChild){ closestTiles(el).appendChild(el.firstElementChild); }
        el.appendChild(tile);
        el.classList.add('filled');
      } else if(origin){
        origin.appendChild(tile);
        if(origin.classList && origin.classList.contains('slot')){
          origin.classList.add('filled');
        }
      }
      cleanup();
    };

    const cancel = ()=>{
      tile.style.outline='';
      if(hoverSlot){ hoverSlot.style.transform=''; }
      if(origin){
        origin.appendChild(tile);
        if(origin.classList && origin.classList.contains('slot')){
          origin.classList.add('filled');
        }
      }
      cleanup();
    };

    const cleanup = ()=>{
      window.removeEventListener('touchmove', move);
      window.removeEventListener('touchend', finish);
      window.removeEventListener('touchcancel', cancel);
    };

    window.addEventListener('touchmove', move, {passive:false});
    window.addEventListener('touchend', finish, {passive:false});
    window.addEventListener('touchcancel', cancel, {passive:false});
  }

  // --- CHECK / RESET ----------------------------------------------------
  function checkAnswers(){
    let correct=0, total=cards.length;
    document.querySelectorAll('.card').forEach(card=>{
      const word = card.dataset.word.toUpperCase();
      const slots = [...card.querySelectorAll('.slot')];
      const guess = slots.map(s=> (s.firstElementChild?.textContent||' ')).join('');
      const ok = (guess===word);
      if(ok){ correct++; card.classList.add('ok'); card.classList.remove('no');}
      else { card.classList.add('no'); card.classList.remove('ok');}
      // colorkan slot benar/salah
      slots.forEach((s,i)=>{
        if((s.firstElementChild?.textContent||'') === word[i]){ s.style.borderColor='var(--ok)'; s.style.background='#f2fff7'; }
        else { s.style.borderColor='var(--no)'; s.style.background='#fff5f4'; }
      });
    });

    if(correct===total){
      statusEl.textContent = `Hebat! Semua benar (${correct}/${total}).`;
      statusEl.className = 'status ok';
      ding(true); updateScore(+10);
    } else {
      statusEl.textContent = `Masih ada yang salah: ${correct}/${total} benar.`;
      statusEl.className = 'status no';
      ding(false);
    }
  }

  function resetBoard(){
    statusEl.textContent='';
    document.querySelectorAll('.card').forEach(card=>{
      card.classList.remove('ok','no');
      card.querySelectorAll('.slot').forEach(s=>{
        const pool = closestTiles(s);
        if(s.firstElementChild){ pool.appendChild(s.firstElementChild); }
        s.classList.remove('filled');
        s.style.borderColor = '#cfd3ff';
        s.style.background = '#f7f8ff';
      });
    });
  }

  function updateScore(delta){
    score = Math.max(0, score + delta);
    localStorage.setItem(LS_KEY, String(score));
    scorePill.textContent = `Skor: ${score}`;
  }

  // --- UTILS ------------------------------------------------------------
  function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]];} return arr; }
  function scramble(word){
    const arr = word.toUpperCase().split('');
    // pastikan tidak identik dengan kata asli
    do{ shuffle(arr); } while(arr.join('')===word.toUpperCase());
    return arr;
  }

  // Simple sound
  let audioCtx; function ding(ok){ try{ audioCtx=audioCtx||new (window.AudioContext||window.webkitAudioContext)(); const o=audioCtx.createOscillator(); const g=audioCtx.createGain(); o.type= ok?'triangle':'sawtooth'; o.frequency.value= ok? 880: 220; g.gain.value=.0001; g.gain.exponentialRampToValueAtTime(.2, audioCtx.currentTime+.01); o.connect(g).connect(audioCtx.destination); o.start(); setTimeout(()=>{g.gain.exponentialRampToValueAtTime(.00001, audioCtx.currentTime+.21); o.stop(audioCtx.currentTime+.22);}, 180);}catch(e){} }

  // --- EVENTS -----------------------------------------------------------
  btnCheck.addEventListener('click', checkAnswers);
  btnReset.addEventListener('click', resetBoard);
  btnShuffle.addEventListener('click', newRound);

  newRound();
})();
</script>
<div class="finish-bar"><button id="btnSelesai" type="button">Selesai</button></div>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="/elearn/manifest-lessons.js"></script>
<script src="/elearn/userInfo.js"></script>
<script src="/elearn/common/worksheet-submit.js"></script>
<script>
  window.WORKSHEET_DEBUG = true;
  const info = (typeof getUserInfo === "function") ? getUserInfo() : {};
  initWorksheetSubmit({
    muridUid: info.uid || "",
    cid: info.cid || "",
    namaAnak: info.nama || "",
    role: (info.role || "").toLowerCase()
  });
</script>
<script src="/elearn/common/calistung-navbar.js"></script>
</body>
</html>