<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Shape L6 – Triangle Paint</title>
  <style>
    :root{
      --bg:#f6f8ff;--card:#ffffff;--ink:#0f172a;--muted:#64748b;--accent:#2563eb;
      --ok:#16a34a;--bad:#ef4444;--outline:#1f2937;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;color:var(--ink);background:var(--bg);}    
    .wrap{max-width:1080px;margin:0 auto;padding:18px;}
    header{display:flex;align-items:center;gap:16px;flex-wrap:wrap;margin-bottom:12px}
    .logo{width:36px;height:36px;display:grid;place-items:center;background:#e2e8f0;border-radius:10px}
    h1{font-size:22px;margin:0}
    .subtitle{font-size:14px;color:var(--muted)}

    .board{background:var(--card);border-radius:16px;padding:16px;box-shadow:0 10px 30px rgba(2,6,23,.05)}

    .legend{display:grid;grid-template-columns:repeat(5,160px);justify-content:center;gap:8px;align-items:center;margin-bottom:12px}
    .legend .item{display:flex;align-items:center;justify-content:center;background:#f8fafc;border:1px dashed #cbd5e1;padding:6px;border-radius:10px;font-size:12px;width:160px;height:160px;margin:0}
    .swatch{width:18px;height:18px;border-radius:4px;border:1px solid #00000022}
    .mini{display:grid;place-items:center;width:135px;height:135px}
    .mini svg{width:135px;height:135px}
    .miniTri{stroke:#111827;stroke-width:1.6}

    .item small{color:var(--muted)}

    .toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:12px 0 8px}
    .btn{border:none;padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer;transition:.15s;box-shadow:0 6px 16px rgba(2,6,23,.08)}
    .btn:hover{transform:translateY(-1px)}
    .btn:active{transform:translateY(0)}
    .btn.primary{background:var(--accent);color:#fff}
    .btn.ghost{background:#e5e7eb}
    .btn.success{background:var(--ok);color:#fff}

    .palette{display:flex;gap:10px;flex-wrap:nowrap;align-items:center;overflow-x:auto;padding-bottom:4px}
    .chip{width:170px;height:160px;border-radius:14px;border:2px solid #e5e7eb;cursor:pointer;box-shadow:0 2px 8px rgba(2,6,23,.06);background:#fff;display:grid;place-items:center}
    .chip.active{box-shadow:inset 0 0 0 3px #111827,0 2px 8px rgba(2,6,23,.06)}
    .chipInner{width:160px;height:150px;display:grid;place-items:center}

    .canvasWrap{background:linear-gradient(180deg,#ffffff 0%,#f8fafc 100%);border:1px solid #e5e7eb;border-radius:16px;padding:8px;position:relative}
    svg{width:100%;height:min(72vh,720px);display:block;border-radius:12px;background:#fff}

    .hint{font-size:13px;color:var(--muted);margin-top:8px}

    /* triangle states */
    .tri{stroke:var(--outline);stroke-width:2;fill:#fff;transition:.2s}
    .tri.locked{stroke:var(--ok)}
    .tri.wrong{animation:shake 0.2s 2;stroke:var(--bad)!important}
    @keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-2px)}75%{transform:translateX(2px)}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">▲</div>
      <div>
        <h1>Triangle Paint</h1>
        <div class="subtitle">Warna sesuai contoh: setiap <b>ukuran</b> segitiga punya warna yang benar. Klik warna → klik segitiga.</div>
      </div>
    </header>

    <section class="board" aria-label="triangle-paint">
      <!-- <div class="legend" id="legend"></div> -->

      <div class="toolbar">
        <div class="palette" id="palette"></div>
        <button class="btn ghost" id="btnShuffle" type="button">Acak Tata Letak</button>
        <button class="btn primary" id="btnCheck" type="button">Periksa Jawaban</button>
        <button class="btn" id="btnReset" type="button">Reset</button>
      </div>

      <div class="canvasWrap">
        <svg id="stage" viewBox="0 0 1000 650" role="img" aria-label="Bidang segitiga"></svg>
      </div>
      <div class="hint" id="status">Pilih warna di palet, lalu klik segitiga untuk mewarnai.</div>
    </section>
  </div>

<script>
(() => {
  // Mapping ukuran ➜ warna benar
  const RULES = [
    { key:'XS', size:20, color:'#ef4444', label:'Kecil sekali = Merah'},
    { key:'S',  size:34, color:'#22c55e', label:'Kecil = Hijau'},
    { key:'M',  size:50, color:'#3b82f6', label:'Sedang = Biru'},
    { key:'L',  size:74, color:'#f59e0b', label:'Besar = Kuning'},
    { key:'XL', size:96, color:'#8b5cf6', label:'Sangat besar = Ungu'}
  ];
  const MAX_SIDE = Math.max(...RULES.map(r=>r.size));

  // --- mini triangle for legend & palette (with padded viewBox so apex isn't clipped)
  function makeMiniTriangle(side, color){
    const w=160, h=150;       // bigger box so no clipping for XL
    const pad = 8;            // padding for stroke/apex
    const cx = w/2, cy = h/2 + 2;
    const s = side;           // EXACT same side length as canvas
    const triH = Math.sqrt(3)/2 * s;
    const topY  = cy - triH/1.2;  // SAME multipliers as canvas triPoints
    const baseY = cy + triH/1.8;
    const p1 = `${cx},${topY}`;
    const p2 = `${cx - s/2},${baseY}`;
    const p3 = `${cx + s/2},${baseY}`;

    const wrap = document.createElement('div');
    wrap.className='mini';
    wrap.innerHTML = `
      <svg viewBox="-${pad} -${pad} ${w + pad*2} ${h + pad*2}" aria-hidden="true">
        <polygon class="miniTri" points="${p1} ${p2} ${p3}" fill="${color}" />
      </svg>`;
    return wrap;
  }

  const stage = document.getElementById('stage');
  const palette = document.getElementById('palette');
  const legend = document.getElementById('legend');
  const statusEl = document.getElementById('status');
  const btnShuffle = document.getElementById('btnShuffle');
  const btnCheck = document.getElementById('btnCheck');
  const btnReset = document.getElementById('btnReset');

  let activeColor = RULES[0].color;
  const triangles = []; // {node, rule}

  function buildLegend(){
    legend.innerHTML = '';
    RULES.forEach(r=>{
      const el = document.createElement('div');
      el.className = 'item';
      el.appendChild(makeMiniTriangle(r.size, r.color));
      legend.appendChild(el);
    });
  }

  function buildPalette(){
    palette.innerHTML='';
    RULES.forEach((r,i)=>{
      const chip = document.createElement('button');
      chip.type='button';
      chip.className='chip'+(i===0?' active':'');
      // insert proportional triangle SVG inside fixed box
      const box = document.createElement('div');
      box.className='chipInner';
      const mini = makeMiniTriangle(r.size, r.color);
      box.appendChild(mini);
      chip.appendChild(box);
      chip.title=r.label;
      chip.addEventListener('click',()=>{
        [...palette.children].forEach(c=>c.classList.remove('active'));
        chip.classList.add('active');
        activeColor = r.color;
        setStatus('Warna aktif dipilih. Sekarang klik segitiga.');
      });
      palette.appendChild(chip);
    });
  }

  // Utility create triangle points centered at (cx,cy) with side ~ size
  function triPoints(cx, cy, side){
    const h = Math.sqrt(3)/2 * side;
    const x1 = cx,     y1 = cy - h/1.2;  // top
    const x2 = cx - side/2, y2 = cy + h/1.8;
    const x3 = cx + side/2, y3 = cy + h/1.8;
    return `${x1},${y1} ${x2},${y2} ${x3},${y3}`;
  }

  function randomFrom(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

  function buildBoard(){
    stage.innerHTML = '';
    triangles.length = 0;

    // create 28 triangles (variasi ukuran)
    const cols = 7, rows = 4;
    const padding = 120; // bigger margin so triangles never touch/crop frame
    const w = 1000, h = 650;

    for(let r=0; r<rows; r++){
      for(let c=0; c<cols; c++){
        const rule = randomFrom(RULES);
        const cx = padding + c*((w-2*padding)/(cols-1)) + (Math.random()*18-9);
        const cy = padding + r*((h-2*padding)/(rows-1)); // align rows exactly (no vertical jitter)
        const side = rule.size; // exact size per rule (no jitter)

        const g = document.createElementNS('http://www.w3.org/2000/svg','g');
        const p = document.createElementNS('http://www.w3.org/2000/svg','polygon');
        p.setAttribute('points', triPoints(cx,cy,side));
        p.setAttribute('class','tri');
        p.dataset.key = rule.key;
        p.dataset.correct = rule.color;
        p.style.fill = '#fff';

        p.addEventListener('click', () => paintTriangle(p));
        g.appendChild(p);
        stage.appendChild(g);
        triangles.push({node:p, rule});
      }
    }
  }

  function paintTriangle(p){
    p.style.fill = activeColor;
    // check immediate correctness
    if(p.dataset.correct === activeColor){
      p.classList.add('locked');
      p.classList.remove('wrong');
    }else{
      p.classList.remove('locked');
      p.classList.add('wrong');
      setTimeout(()=>p.classList.remove('wrong'), 400);
    }
  }

  function shuffle(){
    // random translate for each group, but keep rows vertically aligned
    [...stage.querySelectorAll('g')].forEach(g=>{
      const dx = (Math.random()*16-8);
      const dy = 0; // keep rows aligned; no vertical shift on shuffle
      g.setAttribute('transform',`translate(${dx},${dy})`);
    });
    setStatus('Tata letak diacak.');
  }

  function setStatus(msg){ statusEl.textContent = msg; }

  function checkAll(){
    let correct=0;
    triangles.forEach(({node})=>{
      const ok = node.style.fill === node.dataset.correct;
      node.classList.toggle('locked', ok);
      node.classList.toggle('wrong', !ok);
      if(ok) correct++;
    });
    const score = Math.round(100*correct/triangles.length);
    setStatus(`Skor: ${score}% • ${correct}/${triangles.length} segitiga sudah benar.`);
  }

  function resetAll(){
    triangles.forEach(({node})=>{node.style.fill='#fff';node.classList.remove('locked','wrong');});
    setStatus('Pilih warna lalu klik segitiga untuk mewarnai.');
  }

  // init
  // buildLegend(); // legend hidden
  buildPalette();
  buildBoard();

  btnShuffle.addEventListener('click', shuffle);
  btnCheck.addEventListener('click', checkAll);
  btnReset.addEventListener('click', resetAll);
})();
</script>
</body>
</html>
