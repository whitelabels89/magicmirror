<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MG-L10 ‚Ä¢ Jumlahkan Sesuai Petunjuk</title>
  <link rel="stylesheet" href="/elearn/worlds/calistung/math-game/mathgame-shell.css" />
  <style>
    .animal-grid-stage {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .animal-grid-stage .title-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 10px 16px;
      border-radius: 16px;
      background: #e7f0ff;
      color: #0b63f6;
      font-weight: 800;
      letter-spacing: .5px;
    }

    .animal-grid-stage .legend {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(120px,1fr));
      gap: 12px;
    }

    .animal-grid-stage .cell {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      background: #f8fbff;
      border: 2px solid #e9f2ff;
      border-radius: 16px;
      padding: 12px;
      box-shadow: 0 10px 22px rgba(59, 130, 246, 0.12);
    }

    .animal-grid-stage .animal {
      font-size: 44px;
      line-height: 1;
    }

    .animal-grid-stage .num-tag {
      width: 52px;
      height: 38px;
      border: 2px dashed #cbdafc;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: #0b63f6;
      background: #fff;
    }

    .animal-grid-stage .grid {
      display: grid;
      grid-template-columns: repeat(5, minmax(60px,1fr));
      gap: 12px;
      align-items: center;
    }

    .animal-grid-stage .pill {
      background: #f8fbff;
      border: 2px solid #e9f2ff;
      border-radius: 16px;
      padding: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 64px;
      font-weight: 700;
    }

    .animal-grid-stage .op { color: #3b82f6; font-size: 24px; }

    .animal-grid-stage input.answer {
      width: 100%;
      max-width: 120px;
      height: 48px;
      border: 2px solid #d8e7ff;
      border-radius: 14px;
      font-size: 20px;
      text-align: center;
      color: #1f2a44;
      background: #fff;
      transition: border-color .18s ease, box-shadow .18s ease;
    }

    .animal-grid-stage input.answer:focus {
      outline: none;
      box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.18);
      border-color: #3b82f6;
    }

    .animal-grid-stage .status-text {
      text-align: center;
      font-weight: 700;
      color: rgba(51, 65, 85, 0.85);
    }

    .animal-grid-stage .hint {
      font-size: 13px;
      color: rgba(100, 116, 139, 0.9);
      text-align: center;
    }

    @media (max-width: 720px){
      .animal-grid-stage .grid { grid-template-columns: repeat(5, minmax(54px,1fr)); }
      .animal-grid-stage .animal { font-size: 36px; }
    }
  </style>
  <link rel="stylesheet" href="/elearn/worlds/calistung/buttons.css" />
</head>
<body class="mathgame-shell" data-nav-badge="Calistung Math" data-nav-home-url="/elearn/worlds/calistung/index.html">
  <div class="shell-wrapper">
    <header class="shell-header">
      <div class="shell-header__title">
        <span class="shell-badge">Level 10</span>
        <h1 class="shell-title">Jumlahkan Sesuai Petunjuk</h1>
        <p class="shell-subtitle">Gunakan nilai hewan di legenda, kalikan sesuai petunjuk, dan isi semua jawabannya.</p>
      </div>
      <div class="shell-hud">
        <div class="shell-pill">
          <span class="shell-pill-label">Jawaban Benar</span>
          <span class="shell-pill-value" data-hud-value="score">0 / 8</span>
        </div>
        <div class="shell-pill">
          <span class="shell-pill-label">Percobaan</span>
          <span class="shell-pill-value" data-hud-value="attempts">0</span>
        </div>
      </div>
    </header>

    <section class="mission-card">
      <h2>üéØ Misimu</h2>
      <p data-mission-text>Perhatikan nilai setiap hewan, isi hasil perkalian di grid, lalu cek jawabanmu sampai semua benar.</p>
    </section>

    <main class="mathgame-stage">
      <section class="stage-card stage-card--contrast animal-grid-stage">
        <div class="title-badge">Legenda Hewan</div>
        <div class="legend" id="legend"></div>
        <p class="status-text" id="statusText">Isi semua kotak, lalu klik Periksa.</p>
        <div class="grid" id="quizGrid"></div>
        <p class="hint">Tip: Perkalian menggunakan nilai 1‚Äì5 dari legenda di atas.</p>
      </section>
    </main>

    <section class="shell-action-bar" aria-label="Kontrol aksi">
      <button id="shuffleBtn" class="shell-button secondary" type="button">üîÑ Acak Soal</button>
      <button id="checkBtn" class="shell-button" type="button">‚úÖ Periksa Jawaban</button>
      <button id="resetBtn" class="shell-button ghost" type="button">‚Ü∫ Reset</button>
      <button id="btnSelesai" class="shell-button ghost" type="button">Selesai</button>
    </section>

    <aside class="buddy-widget" aria-label="Teman penyemangat">
      <div class="buddy-avatar" data-buddy-emoji aria-hidden="true">ü¶Å</div>
      <div class="buddy-dialog" data-buddy-dialog>Kalikan nilai hewannya dan lengkapi semua kotak. Kalau bingung, lihat legenda di atas.</div>
    </aside>
  </div>
  <script src="/elearn/worlds/calistung/math-game/mathgame-shell.js"></script>
  <script>
    const ANIMALS = [
      { key: 'tiger',   label: 'Harimau',  emoji: 'üêØ', value: 1 },
      { key: 'koala',   label: 'Koala',    emoji: 'üê®', value: 2 },
      { key: 'panda',   label: 'Panda',    emoji: 'üêº', value: 3 },
      { key: 'rabbit',  label: 'Kelinci',  emoji: 'üê∞', value: 4 },
      { key: 'squirrel',label: 'Tupai',    emoji: 'üêøÔ∏è', value: 5 },
    ];

    const BASE_EQUATIONS = [
      ['panda','tiger'],
      ['squirrel','koala'],
      ['koala','panda'],
      ['squirrel','tiger'],
      ['panda','rabbit'],
      ['rabbit','squirrel'],
      ['tiger','tiger'],
      ['koala','koala'],
    ];

    const legend = document.getElementById('legend');
    const grid   = document.getElementById('quizGrid');
    const statusEl  = document.getElementById('statusText');

    const shuffleBtn = document.getElementById('shuffleBtn');
    const resetBtn   = document.getElementById('resetBtn');
    const checkBtn   = document.getElementById('checkBtn');

    const hudScoreEl = document.querySelector('[data-hud-value="score"]');
    const hudAttemptsEl = document.querySelector('[data-hud-value="attempts"]');
    const buddyEmojiEl = document.querySelector('[data-buddy-emoji]');
    const buddyDialogEl = document.querySelector('[data-buddy-dialog]');

    let equations = [...BASE_EQUATIONS];
    let attempts = 0;
    let correctCount = 0;

    function setBuddy(emoji, text){
      if(buddyEmojiEl && emoji){ buddyEmojiEl.textContent = emoji; }
      if(buddyDialogEl && text){ buddyDialogEl.textContent = text; }
      if(window.mathgameShell && typeof window.mathgameShell.setBuddyMood === 'function'){
        window.mathgameShell.setBuddyMood(emoji, text);
      }
    }

    function syncHud(){
      const label = `${correctCount} / ${equations.length}`;
      if(hudScoreEl) hudScoreEl.textContent = label;
      if(hudAttemptsEl) hudAttemptsEl.textContent = attempts;
      if(window.mathgameShell && typeof window.mathgameShell.updateHud === 'function'){
        window.mathgameShell.updateHud({ score: label, attempts });
      }
    }

    function animalByKey(k){ return ANIMALS.find(a=>a.key===k); }

    function renderLegend(){
      legend.innerHTML = '';
      ANIMALS.forEach(a=>{
        const cell = document.createElement('div');
        cell.className='cell';
        cell.innerHTML = `
          <div class="animal" aria-label="${a.label}">${a.emoji}</div>
          <div class="num-tag" title="Nilai">${a.value}</div>
        `;
        legend.appendChild(cell);
      });
    }

    function createRow(a1,a2,index){
      const left  = document.createElement('div'); left.className='pill'; left.innerHTML = `<span class="animal" title="${animalByKey(a1).label}">${animalByKey(a1).emoji}</span>`;
      const op1   = document.createElement('div'); op1.className='pill op'; op1.textContent = '√ó';
      const mid   = document.createElement('div'); mid.className='pill'; mid.innerHTML = `<span class="animal" title="${animalByKey(a2).label}">${animalByKey(a2).emoji}</span>`;
      const op2   = document.createElement('div'); op2.className='pill op'; op2.textContent = '=';
      const right = document.createElement('div'); right.className='pill';
      const input = document.createElement('input');
      input.type='number'; input.className='answer'; input.min='0'; input.placeholder='?';
      input.dataset.idx = index;
      input.setAttribute('aria-label', `Jawaban untuk ${animalByKey(a1).label} √ó ${animalByKey(a2).label}`);
      right.appendChild(input);
      grid.append(left,op1,mid,op2,right);
    }

    function expectedValue(a1,a2){
      return animalByKey(a1).value * animalByKey(a2).value;
    }

    function renderGrid(){
      grid.innerHTML='';
      equations.forEach((pair,i)=>createRow(pair[0], pair[1], i));
    }

    function shuffle(){
      for(let i=equations.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [equations[i],equations[j]] = [equations[j],equations[i]];
      }
      renderGrid();
      correctCount = 0;
      attempts = 0;
      statusEl.textContent = 'Diacak! Isi lagi dan klik Periksa.';
      setBuddy('üé≤', 'Soalnya diganti. Isi lagi hasil perkalianmu!');
      syncHud();
    }

    function resetAll(){
      document.querySelectorAll('input.answer').forEach(i=>{
        i.value=''; i.classList.remove('ok','no'); i.style.borderColor = '#d8e7ff'; i.style.background='white';
      });
      correctCount = 0;
      attempts = 0;
      statusEl.textContent='Isi semua kotak, lalu klik Periksa.';
      setBuddy('üìù', 'Kosongkan lagi dan mulai dari awal. Kamu pasti bisa!');
      syncHud();
    }

    function check(){
      let correct=0, total=equations.length, empty=0;
      document.querySelectorAll('input.answer').forEach((input,idx)=>{
        const [a1,a2] = equations[idx];
        const need = expectedValue(a1,a2);
        const val = Number(input.value);
        input.classList.remove('ok','no');
        if(input.value===''){
          input.style.background = '#fef3c7';
          empty++;
          return;
        }
        if(val===need){
          input.classList.add('ok');
          input.style.background = '#d1fae5';
          correct++;
        }else{
          input.classList.add('no');
          input.style.background = '#fee2e2';
        }
      });
      correctCount = correct;
      attempts += 1;
      if(empty>0){
        statusEl.textContent = `Masih ada ${empty} yang kosong. Isi semuanya dulu ya!`;
        setBuddy('ü§ì', 'Coba isi semua kotak dulu sebelum cek jawabannya.');
      }else if(correct === total){
        statusEl.textContent = `Skor: ${correct}/${total} benar. Perfect!`;
        setBuddy('üèÜ', 'Woohoo! Semua benar. Hebat!');
      }else{
        statusEl.textContent = `Skor: ${correct}/${total} benar. Perbaiki yang masih salah ya!`;
        setBuddy('üßê', 'Coba cek lagi kotak yang masih salah. Kamu hampir berhasil!');
      }
      syncHud();
    }

    renderLegend();
    renderGrid();
    syncHud();

    shuffleBtn.addEventListener('click', shuffle);
    resetBtn.addEventListener('click', resetAll);
    checkBtn.addEventListener('click', check);
    setBuddy('ü¶Å', 'Kalikan hewan sesuai nilainya, lalu isi semua hasilnya.');
  </script>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="/elearn/manifest-lessons.js"></script>
  <script src="/elearn/userInfo.js"></script>
  <script src="/elearn/common/worksheet-submit.js"></script>
  <script>
    window.WORKSHEET_DEBUG = true;
    window.WORKSHEET_META = { course_id: "mathgame-basic" };
    const info = (typeof getUserInfo === "function") ? getUserInfo() : {};
    initWorksheetSubmit({
      muridUid: info.uid || "",
      cid: info.cid || "",
      namaAnak: info.nama || "",
      role: (info.role || "").toLowerCase()
    });
  </script>
  <script src="/elearn/common/calistung-navbar.js"></script>
</body>
</html>
