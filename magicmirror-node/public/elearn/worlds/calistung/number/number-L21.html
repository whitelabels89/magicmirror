

<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>J3 – Memecahkan Kode</title>
  <style>
    :root{
      --green:#45b058;
      --dark:#222;
      --gray:#e9eef3;
      --white:#fff;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: ui-rounded, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji"; color:var(--dark); background:#f8fafb;
    }
    header{
      padding:18px 16px; background:var(--green); color:white; text-align:center;
    }
    header h1{margin:0; font-size:clamp(22px,4vw,40px); letter-spacing:1px}
    header p{margin:.35rem 0 0; opacity:.95; font-weight:600}

    .container{max-width:1000px; margin:18px auto 64px; padding:0 16px}

    .key{
      width:100%; border-collapse:separate; border-spacing:0; overflow:hidden; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,.06); margin:8px 0 18px; background:white;
    }
    .key thead th{
      background:var(--green); color:white; padding:8px; font-size:14px;
    }
    .key td, .key th{ text-align:center; padding:8px 6px; }
    .key tbody tr:nth-child(odd) td{ background:#f5fbf6 }

    .row{ 
      display:grid; 
      grid-template-rows:56px 56px; /* baris 1 = soal angka, baris 2 = jawaban */
      gap:8px; 
      align-items:stretch; 
      margin:18px 0; 
      overflow-x:auto; 
      padding-bottom:4px;
    }
    /* container angka & jawaban sekarang digabung dalam .row, kelas di bawah dipertahankan
       agar tidak mengganggu style box */
    .numbers, .inputs{ display:contents; }

    .numBox, .inBox{
      display:flex; align-items:center; justify-content:center; background:white; border:2px solid #d9e3ea; border-radius:8px; box-shadow:0 1px 3px rgba(0,0,0,.05);
      font-weight:700;
    }
    .numBox{ font-size:18px; }
    .inBox input{
      width:100%; height:100%; text-transform:uppercase; text-align:center; font-size:20px; font-weight:800; border:0; outline:0; background:transparent; letter-spacing:1px;
    }

    .controls{ display:flex; flex-wrap:wrap; gap:10px; margin:22px 0 8px }
    .btn{
      border:0; background:var(--dark); color:white; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:700; box-shadow:0 2px 6px rgba(0,0,0,.15);
    }
    .btn.secondary{ background:#4b5563 }
    .btn.success{ background:#1ea672 }
    .btn.warn{ background:#d97706 }

    .result{ margin-top:8px; font-weight:700 }
    .tag{display:inline-block; padding:4px 8px; border-radius:999px; font-size:12px; margin-left:8px}
    .tag.ok{ background:#e8fff5; color:#0f8b56; border:1px solid #b6f2d4 }
    .tag.no{ background:#fff3f0; color:#9a3412; border:1px solid #ffd5cc }

    .credit{opacity:.7; font-size:12px; text-align:center; margin-top:10px}

    @media (max-width:720px){
      .row{ grid-template-columns:1fr; }
    }
  </style>
</head>
<body>
  <header>
    <h1>MEMECAHKAN KODE</h1>
    <p>Gunakan kunci di bawah ini untuk membantu memecahkan kodenya!</p>
  </header>

  <div class="container">
    <!-- Kunci huruf = angka -->
    <table class="key" aria-label="kunci huruf angka">
      <thead>
        <tr>
          <th colspan="13">a–m</th>
          <th colspan="13">n–z</th>
        </tr>
      </thead>
      <tbody>
        <tr id="row-letters-a"></tr>
        <tr id="row-numbers-a"></tr>
        <tr id="row-letters-n"></tr>
        <tr id="row-numbers-n"></tr>
      </tbody>
    </table>

    <div class="controls">
      <button class="btn" id="btnShuffle">Acak Soal</button>
      <button class="btn secondary" id="btnReset">Reset</button>
      <button class="btn success" id="btnCheck">Periksa Jawaban</button>
    </div>

    <div id="game"></div>

    <p class="credit">© Queen's Academy – J3</p>
  </div>

  <script>
    // Helper: alphabet map
    const A2Z = Array.from({length:26}, (_,i)=>String.fromCharCode(97+i)); // a..z
    const map = Object.fromEntries(A2Z.map((ch,i)=>[ch,(i+1)]));

    // Build key table visually like worksheet
    function buildKey(){
      const rLa = document.getElementById('row-letters-a');
      const rNa = document.getElementById('row-numbers-a');
      const rLn = document.getElementById('row-letters-n');
      const rNn = document.getElementById('row-numbers-n');
      rLa.innerHTML = A2Z.slice(0,13).map(ch=>`<td style="background:var(--green);color:white;font-weight:800;text-transform:lowercase">${ch}</td>`).join("");
      rNa.innerHTML = A2Z.slice(0,13).map((_,i)=>`<td>${i+1}</td>`).join("");
      rLn.innerHTML = A2Z.slice(13).map(ch=>`<td style="background:var(--green);color:white;font-weight:800;text-transform:lowercase">${ch}</td>`).join("");
      rNn.innerHTML = A2Z.slice(13).map((_,i)=>`<td>${i+14}</td>`).join("");
    }

    // Puzzles (sesuai worksheet)
    const phrases = [
      { lead:[9,1,13], word:[23,15,18,20,8,25] }, // I AM WORTHY
      { lead:[9,1,13], word:[22,1,12,21,5,4] },   // I AM VALUED
      { lead:[9,1,13], word:[12,15,22,5,4] },     // I AM LOVED
      { lead:[9,1,13], word:[2,18,1,22,5] },      // I AM BRAVE
      { lead:[9,1,13], word:[5,14,15,21,7,8] },   // I AM ENOUGH
    ];

    function toLetters(nums){
      return nums.map(n=>String.fromCharCode(96+n));
    }

    function box(html, cls="numBox"){ return `<div class="${cls}">${html}</div>` }

    function render(){
      const wrap = document.getElementById('game');
      wrap.innerHTML = "";
      puzzles.forEach((p,idx)=>{
        const total = p.lead.length + p.word.length; // jumlah kolom
        const row = document.createElement('div');
        row.className = 'row';
        row.style.gridTemplateColumns = `repeat(${total}, 56px)`; // 1 baris penuh

        // baris angka (row 1)
        const allNums = [...p.lead, ...p.word];
        allNums.forEach(n=>{
          const boxEl = document.createElement('div');
          boxEl.className = 'numBox';
          boxEl.textContent = n;
          boxEl.style.gridRow = '1';
          row.appendChild(boxEl);
        });

        // baris jawaban (row 2) – buat input di bawah SETIAP angka
        allNums.forEach((n,i)=>{
          const inWrap = document.createElement('div');
          inWrap.className = 'inBox';
          inWrap.style.gridRow = '2';
          // Input untuk 9 1 13 juga ada (biarkan kosong, tidak dinilai)
          const ghost = (i < p.lead.length);
          inWrap.innerHTML = `<input maxlength="1" ${ghost? 'data-ghost="true"':''} data-n="${n}">`;
          row.appendChild(inWrap);
        });

        wrap.appendChild(row);
      });
      bindInputs();
    }

    function bindInputs(){
      document.querySelectorAll('.inBox input').forEach(inp=>{
        inp.addEventListener('input', e=>{
          // allow only A-Z
          e.target.value = e.target.value.replace(/[^a-zA-Z]/g,'').toUpperCase().slice(0,1);
        });
      });
    }

    function check(){
      let allCorrect = true;
      // Only check inputs that are not ghost (the ones under 9 1 13 are decorative)
      document.querySelectorAll('.inBox input[data-ghost!="true"]').forEach(inp=>{
        const expected = String.fromCharCode(64 + Number(inp.dataset.n)); // A=1->Z=26
        const ok = (inp.value.toUpperCase() === expected);
        inp.parentElement.style.borderColor = ok ? '#19a86a' : '#ef4444';
        inp.parentElement.style.background = ok ? '#eafff4' : '#fff5f5';
        allCorrect = allCorrect && ok;
      });
      showResult(allCorrect);
    }

    function resetInputs(){
      document.querySelectorAll('.inBox input').forEach(inp=>{
        inp.value = '';
        inp.parentElement.style.borderColor = '#d9e3ea';
        inp.parentElement.style.background = '#fff';
      });
      showResult(null);
    }

    function showResult(ok){
      if(!resultEl){
        const p = document.createElement('p');
        p.className = 'result';
        document.querySelector('.container').appendChild(p);
        resultEl = p;
      }
      if(ok === null){ resultEl.textContent = ''; return; }
      if(ok){
        resultEl.innerHTML = 'Mantap! Semua jawaban benar. <span class="tag ok">✔︎ tepat</span>';
      } else {
        resultEl.innerHTML = 'Masih ada yang keliru. Coba cek lagi ya. <span class="tag no">✖︎ periksa</span>';
      }
    }

    function shuffle(arr){
      return arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(x=>x[1]);
    }

    // state
    let puzzles = [];
    let resultEl = null;

    // controls
    document.addEventListener('click', (e)=>{
      if(e.target.id==='btnShuffle'){
        puzzles = shuffle(phrases.slice());
        render();
        showResult(null);
      }
      if(e.target.id==='btnReset'){
        resetInputs();
      }
      if(e.target.id==='btnCheck'){
        check();
      }
    });

    // init
    buildKey();
    puzzles = phrases.slice();
    render();
  </script>

<style>
  .finish-bar { position: fixed; right: 16px; bottom: 16px; z-index: 1000; }
  #btnSelesai { background: #22c55e; color: #fff; border: none; cursor: pointer; padding: 12px 16px; border-radius: 12px; font-weight: 700; font-size: 16px; box-shadow: 0 6px 18px rgba(16, 185, 129, 0.4); }
  #btnSelesai:hover { filter: brightness(1.05); }
  #btnSelesai:active { transform: translateY(1px); }
  @media (max-width: 480px) {
    #btnSelesai { padding: 10px 14px; font-size: 15px; }
  }
</style>

<div class="finish-bar"><button id="btnSelesai" type="button">Selesai</button></div>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="/elearn/manifest-lessons.js"></script>
<script src="/elearn/userInfo.js"></script>
<script src="/elearn/common/worksheet-submit.js"></script>
<script>
  // Debug log
  window.WORKSHEET_DEBUG = true;
  window.WORKSHEET_META = { course_id: "numbers-basic" };

  // Ambil info user dari localStorage via userInfo.js
  const info = (typeof getUserInfo === 'function') ? getUserInfo() : {};
  const role = (info.role || '').toLowerCase();

  initWorksheetSubmit({
    muridUid: info.uid || '',
    cid: info.cid || '',
    namaAnak: info.nama || '',
    role: role
  });
</script>

</body>
</html>
