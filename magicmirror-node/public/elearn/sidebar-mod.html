<style>
  .meteor {
    width: 20px;
    height: 6px;
    background: linear-gradient(90deg, white, transparent);
    position: absolute;
    z-index: 999;
    offset-distance: 0%;
    offset-rotate: auto;
    animation: moveMeteor 4s linear infinite;
  }

  @keyframes moveMeteor {
    from {
      offset-distance: 0%;
    }
    to {
      offset-distance: 100%;
    }
  }
</style>
<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/elearn/sidebar-mod.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

<div id="sidebar-container">
  <aside class="sidebar" style="min-width: max-content;">
    <div class="sidebar-logo">
      <img src="/elearn/img/icoding.png" alt="Logo">
    </div>
    <nav class="sidebar-nav">
      <div class="menu-group">
        <a href="moderator.html" class="active"><i class="fas fa-home"></i> <span class="sidebar-label">Dashboard</span></a>
        <hr class="sidebar-divider">
      </div>
      <div class="menu-group">
        <a><i class="fas fa-user-cog"></i> <span class="sidebar-label">Account Management</span></a>
        <ul class="submenu">
          <li><a href="student-acc.html"><i class="fas fa-user"></i><span class="sidebar-label">Student Accounts</span></a></li>
          <li><a href="teacher.html"><i class="fas fa-chalkboard-teacher"></i><span class="sidebar-label">Teacher Accounts</span></a></li>
          <li><a href="parent-acc.html"><i class="fas fa-users"></i><span class="sidebar-label">Parent Accounts</span></a></li>
          <li><a href="create-account.html"><i class="fas fa-user-plus"></i><span class="sidebar-label">Create New Account</span></a></li>
        </ul>
        <hr class="sidebar-divider">
      </div>
      <div class="menu-group">
        <a><i class="fas fa-book"></i> <span class="sidebar-label">Lesson Management</span></a>
        <ul class="submenu">
          <li><a href="generated-lessons.html"><i class="fas fa-book-open"></i><span class="sidebar-label">Interactive Lessons</span></a></li>
          <li><a href="lesson-access.html"><i class="fas fa-unlock"></i><span class="sidebar-label">Lesson Access</span></a></li>
        </ul>
        <hr class="sidebar-divider">
      </div>
      <div class="menu-group">
        <a><i class="fas fa-school"></i> <span class="sidebar-label">Class & Progress</span></a>
        <ul class="submenu">
          <li><a href="classes.html"><i class="fas fa-layer-group"></i><span class="sidebar-label">Active Classes</span></a></li>
          <li><a href="progress-tracking.html"><i class="fas fa-chart-line"></i><span class="sidebar-label">Student Progress</span></a></li>
          <li><a href="student-works.html"><i class="fas fa-paint-brush"></i><span class="sidebar-label">Student Works</span></a></li>
          <li><a href="activity-report.html"><i class="fas fa-file-alt"></i><span class="sidebar-label">Activity Reports</span></a></li>
        </ul>
        <hr class="sidebar-divider">
      </div>
      <div class="menu-group">
        <a><i class="fas fa-medal"></i> <span class="sidebar-label">Badges & Rewards</span></a>
        <ul class="submenu">
          <li><a href="manage-badges.html"><i class="fas fa-award"></i><span class="sidebar-label">Manage Badges</span></a></li>
          <li><a href="scoring.html"><i class="fas fa-check-circle"></i><span class="sidebar-label">Auto/Manual Scoring</span></a></li>
          <li><a href="reward-history.html"><i class="fas fa-gift"></i><span class="sidebar-label">Reward History</span></a></li>
        </ul>
        <hr class="sidebar-divider">
      </div>
      <div class="menu-group">
        <a><i class="fas fa-cogs"></i> <span class="sidebar-label">System Settings</span></a>
        <ul class="submenu">
          <li><a href="env-settings.html"><i class="fas fa-code"></i><span class="sidebar-label">Developer</span></a></li>
          <li><a href="sheet-sync.html"><i class="fas fa-sync"></i><span class="sidebar-label">Sync</span></a></li>
          <li><a href="firebase-monitor.html"><i class="fas fa-fire"></i><span class="sidebar-label">Firebase Monitor</span></a></li>
          <li><a href="whatsapp.html"><i class="fas fa-bell"></i><span class="sidebar-label">Notification</span></a></li>
        </ul>
        <hr class="sidebar-divider">
      </div>
    </nav>
    <div class="menu-group">
      <a href="#" id="logout-btn"><i class="fas fa-sign-out-alt"></i> <span class="sidebar-label">Logout</span></a>
    </div>
    <div class="meteor"></div>
    <button id="sidebar-toggle" class="sidebar-toggle">
      <i class="fas fa-angle-left"></i>
    </button>
  </aside>
</div>
<script>
  const toggleBtn = document.getElementById('sidebar-toggle');
  const sidebarContainer = document.getElementById('sidebar-container');
  toggleBtn.addEventListener('click', () => {
    sidebarContainer.classList.toggle('collapsed');
  });

  document.querySelectorAll('.menu-group > a').forEach(group => {
    group.addEventListener('click', () => {
      // Jika sidebar dalam kondisi collapsed, buka dulu
      if (sidebarContainer.classList.contains('collapsed')) {
        sidebarContainer.classList.remove('collapsed');
      }

      // Toggle submenu setelah sidebar terbuka
      group.parentElement.classList.toggle('open');
    });
  });
  document.getElementById('logout-btn').addEventListener('click', (e) => {
    e.preventDefault();
    // Clear session/local storage
    localStorage.clear();
    sessionStorage.clear();
    // Redirect to login page
    window.location.href = '/elearn/login.html';
  });

  function updateMeteorPath() {
    requestAnimationFrame(() => {
      const sidebar = document.querySelector('.sidebar');
      const meteor = document.querySelector('.meteor');

      if (sidebar && meteor) {
        const rect = sidebar.getBoundingClientRect();
        const height = rect.height - 40; // padding atas bawah
        const path = `M20,20 H220 A20,20 0 0 1 240,40 V${height} A20,20 0 0 1 220,${height+20} H20 A20,20 0 0 1 0,${height} V40 A20,20 0 0 1 20,20 Z`;
        meteor.style.offsetPath = `path("${path}")`;
        meteor.style.offsetDistance = '0%';
      }
    });
  }

  function restartMeteorAnimation() {
    const meteor = document.querySelector('.meteor');
    if (meteor) {
      meteor.style.animation = 'none';
      void meteor.offsetWidth; // reflow
      meteor.style.animation = 'moveMeteor 4s linear infinite';
    }
  }

  window.addEventListener('DOMContentLoaded', () => {
    updateMeteorPath();
    restartMeteorAnimation();
  });

  window.addEventListener('load', () => {
    updateMeteorPath();
    restartMeteorAnimation();
    setTimeout(() => {
      updateMeteorPath();
      restartMeteorAnimation();
    }, 500);
  });

  window.addEventListener('resize', updateMeteorPath);

  const observer = new ResizeObserver(() => {
    updateMeteorPath();
    restartMeteorAnimation();
  });

  const sidebarEl = document.querySelector('.sidebar');
  if (sidebarEl) observer.observe(sidebarEl);
</script>
