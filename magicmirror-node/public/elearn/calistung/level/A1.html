<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Tracing Huruf - Level A1</title>
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand+SC&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 10px;
            padding: 0;
            background: #f9f9f9;
        }
        #worksheet-container {
            width: 794px;
            height: 1123px;
            margin: 0 auto;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        .trace-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        .trace-letter {
            position: relative;
            border: 2px solid #aaa;
            border-radius: 6px;
            height: auto;
            aspect-ratio: 1 / 1;
            padding: 10px;
            box-sizing: border-box;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 48px;
            color: transparent;
            -webkit-text-stroke: 1.5px #333;
            cursor: pointer;
            user-select: none;
            transition: all 0.3s ease;
            overflow: hidden;
        }
        .trace-letter.outlined {
            color: transparent;
            -webkit-text-stroke: 1.5px #333;
        }
        .trace-letter .step-number {
            position: absolute;
            top: 4px;
            left: 6px;
            font-size: 14px;
            color: #555;
            font-weight: 600;
            user-select: none;
            z-index: 3;
        }
        .trace-letter canvas.trace-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            pointer-events: auto;
            background-color: transparent;
        }
        #image-letter-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        #image-letter-container > div {
            flex: 1 1 150px;
            text-align: center;
        }
        #image-letter-container .chicken {
            font-size: 120px;
            user-select: none;
        }
        #image-letter-container .big-letter {
            font-size: 120px;
            font-weight: 700;
            color: #d33;
            user-select: none;
        }
        #writing-steps {
            font-size: 18px;
            color: #444;
            margin-top: 10px;
            line-height: 1.4;
        }
        #message {
            margin-top: 20px;
            font-size: 22px;
            font-weight: 700;
            color: green;
            text-align: center;
            user-select: none;
        }
        /* Responsive for small screens */
        @media (max-width: 480px) {
            #image-letter-container {
                flex-direction: column;
            }
            .trace-letter {
                height: 60px;
                font-size: 36px;
            }
            #image-letter-container .chicken,
            #image-letter-container .big-letter {
                font-size: 90px;
            }
            #writing-steps {
                font-size: 16px;
            }
        }
        .worksheet-slide { width: 100%; }
    </style>
</head>
<body>
    <div style="max-width:794px;margin:0 auto 10px auto;display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap">
        <label for="worksheet-select" style="font-weight:600">Pilih Worksheet:</label>
        <select id="worksheet-select" aria-label="Pilih worksheet huruf" style="padding:8px 10px;border-radius:6px;border:1px solid #ccc;min-width:160px;">
            <option value="a" selected>Huruf A</option>
            <option value="b">Huruf B</option>
            <option value="c">Huruf C (coming soon)</option>
            <option value="d">Huruf D (coming soon)</option>
            <option value="e">Huruf E (coming soon)</option>
            <option value="f">Huruf F (coming soon)</option>
            <option value="g">Huruf G (coming soon)</option>
            <option value="h">Huruf H (coming soon)</option>
            <option value="i">Huruf I (coming soon)</option>
            <option value="j">Huruf J (coming soon)</option>
            <option value="k">Huruf K (coming soon)</option>
            <option value="l">Huruf L (coming soon)</option>
            <option value="m">Huruf M (coming soon)</option>
            <option value="n">Huruf N (coming soon)</option>
            <option value="o">Huruf O (coming soon)</option>
            <option value="p">Huruf P (coming soon)</option>
            <option value="q">Huruf Q (coming soon)</option>
            <option value="r">Huruf R (coming soon)</option>
            <option value="s">Huruf S (coming soon)</option>
            <option value="t">Huruf T (coming soon)</option>
            <option value="u">Huruf U (coming soon)</option>
            <option value="v">Huruf V (coming soon)</option>
            <option value="w">Huruf W (coming soon)</option>
            <option value="x">Huruf X (coming soon)</option>
            <option value="y">Huruf Y (coming soon)</option>
            <option value="z">Huruf Z (coming soon)</option>
        </select>
        <small id="coming-soon-note" style="color:#777;display:none">Worksheet huruf ini sedang disiapkan.</small>
    </div>
    <div id="slide-a" class="worksheet-slide" data-letter="a" style="display:block;">
        <div id="worksheet-container" aria-label="Worksheet huruf a">
            <div id="image-letter-container">
                <div class="chicken" aria-label="Gambar ayam" role="img">
                    <img src="/elearn/calistung/assets/alfabet/a-image.png" alt="Gambar ayam" style="width: 350px; height: auto;" />
                </div>
                <div>
                    <img src="/elearn/calistung/assets/alfabet/a-judul.png" alt="Huruf A" style="width: 200px; height: auto;" />
                    <div id="writing-steps" aria-live="polite">
                        Langkah menulis huruf a:<br>
                        1. Mulai dari atas ke bawah.<br>
                        2. Mulai dari atas melingkar ke bawah dan ke kanan.<br>
                    </div>
                </div>
            </div>
            <div class="trace-grid" id="trace-grid-a" aria-label="Soal tracing huruf a">
                <!-- Kotak tracing huruf akan dibuat di sini oleh JS -->
            </div>
            <div id="message-a" role="alert" aria-live="assertive"></div>
        </div>
    </div>
    <div id="slide-b" class="worksheet-slide" data-letter="b" style="display:none;">
        <div id="worksheet-container-b" aria-label="Worksheet huruf b" style="width:794px;height:1123px;margin:0 auto;background:white;padding:15px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.1);">
            <div id="image-letter-container-b" style="display:flex;justify-content:center;align-items:center;gap:20px;margin-bottom:15px;flex-wrap:wrap;">
                <div class="chicken" aria-label="Gambar hewan" role="img">
                    <img src="/elearn/calistung/assets/alfabet/b-image.png" alt="Gambar untuk huruf b" style="width: 350px; height: auto;" />
                </div>
                <div>
                    <img src="/elearn/calistung/assets/alfabet/b-judul.png" alt="Huruf B" style="width: 200px; height: auto;" />
                    <div id="writing-steps-b" aria-live="polite">
                        Langkah menulis huruf b:<br>
                        1. Tarik garis lurus dari atas ke bawah.<br>
                        2. Buat setengah lingkaran dari tengah ke kanan lalu ke bawah.<br>
                    </div>
                </div>
            </div>
            <div class="trace-grid" id="trace-grid-b" aria-label="Soal tracing huruf b"></div>
            <div id="message-b" role="alert" aria-live="assertive"></div>
        </div>
    </div>

    <script>
    (function(){
        const select = document.getElementById('worksheet-select');
        const slideA = document.getElementById('slide-a');
        const slideB = document.getElementById('slide-b');
        const comingNote = document.getElementById('coming-soon-note');

        function buildTracing(gridEl, messageEl, letter) {
            gridEl.innerHTML = '';
            const totalCells = 15; // 3x5
            const upper = letter.toUpperCase();
            const lower = letter.toLowerCase();
            const letters = [upper,upper,upper,lower,lower,lower,upper,upper,upper,lower,lower,lower,upper,upper,upper];
            const stepsAll = [1,2,3,1,2,3,1,2,3,1,2,3,1,2,3];

            const canvases = [];
            const isDrawing = new Array(totalCells).fill(false);
            const paths = new Array(totalCells).fill(null).map(() => []);

            for(let i=0;i<totalCells;i++){
                const div = document.createElement('div');
                div.classList.add('trace-letter','outlined');
                div.setAttribute('tabindex','0');
                div.setAttribute('role','button');
                div.setAttribute('aria-pressed','false');
                div.setAttribute('aria-label', `Huruf ${letters[i]}, langkah ${stepsAll[i]}`);
                div.dataset.index = i;
                div.dataset.step = stepsAll[i];
                div.dataset.letter = letters[i];

                const canvas = document.createElement('canvas');
                canvas.className = 'trace-canvas';
                canvas.width = 150; canvas.height = 150;
                canvas.style.width = '100%';
                canvas.style.height = '100%';
                canvas.style.touchAction = 'none';
                canvas.style.position = 'absolute';
                const ctx = canvas.getContext('2d');

                // background guideline image per letter
                const img = new Image();
                img.src = `/elearn/calistung/assets/alfabet/${letter}.png`;
                img.onload = () => {
                    ctx.clearRect(0,0,canvas.width,canvas.height);
                    ctx.globalAlpha = 0.5;
                    ctx.drawImage(img,0,0,canvas.width,canvas.height);
                    ctx.globalAlpha = 1.0;
                };

                const stepSpan = document.createElement('span');
                stepSpan.className = 'step-number';
                stepSpan.textContent = stepsAll[i];
                div.appendChild(stepSpan);
                div.appendChild(canvas);

                canvases.push({canvas, ctx});
                let lastX=0,lastY=0;

                function getPointerPos(evt){
                    const rect = canvas.getBoundingClientRect();
                    const scaleX = canvas.width / rect.width;
                    const scaleY = canvas.height / rect.height;
                    let clientX, clientY;
                    if(evt.touches && evt.touches.length>0){
                        clientX = evt.touches[0].clientX;
                        clientY = evt.touches[0].clientY;
                    } else {
                        clientX = evt.clientX;
                        clientY = evt.clientY;
                    }
                    return { x: (clientX-rect.left)*scaleX, y: (clientY-rect.top)*scaleY };
                }
                function startDrawing(evt){
                    evt.preventDefault();
                    isDrawing[i]=true;
                    const pos = getPointerPos(evt);
                    lastX = pos.x; lastY = pos.y;
                    paths[i].push([{x:lastX,y:lastY}]);
                }
                function draw(evt){
                    if(!isDrawing[i]) return; evt.preventDefault();
                    const pos = getPointerPos(evt);
                    const path = paths[i][paths[i].length-1];
                    path.push({x:pos.x,y:pos.y});
                    const ctx = canvases[i].ctx;
                    ctx.strokeStyle = '#000';
                    ctx.lineWidth = 2;
                    ctx.lineCap = 'round';
                    ctx.lineJoin = 'round';
                    ctx.beginPath();
                    ctx.moveTo(lastX,lastY);
                    ctx.lineTo(pos.x,pos.y);
                    ctx.stroke();
                    lastX = pos.x; lastY = pos.y;
                }
                function stopDrawing(evt){ if(!isDrawing[i]) return; evt.preventDefault(); isDrawing[i]=false; }

                canvas.addEventListener('mousedown', startDrawing);
                canvas.addEventListener('mousemove', draw);
                canvas.addEventListener('mouseup', stopDrawing);
                canvas.addEventListener('mouseleave', stopDrawing);
                canvas.addEventListener('touchstart', startDrawing, {passive:false});
                canvas.addEventListener('touchmove', draw, {passive:false});
                canvas.addEventListener('touchend', stopDrawing);
                canvas.addEventListener('touchcancel', stopDrawing);

                gridEl.appendChild(div);
            }
            if(messageEl){ messageEl.textContent=''; }
        }

        // Initialize A and B once
        buildTracing(document.getElementById('trace-grid-a'), document.getElementById('message-a'), 'a');
        buildTracing(document.getElementById('trace-grid-b'), document.getElementById('message-b'), 'b');

        function setSlide(letter){
            const isAvailable = (letter==='a' || letter==='b');
            comingNote.style.display = isAvailable ? 'none' : 'inline';
            slideA.style.display = (letter==='a') ? 'block' : 'none';
            slideB.style.display = (letter==='b') ? 'block' : 'none';
        }

        // Initial state
        setSlide('a');

        select.addEventListener('change', (e)=>{
            const val = (e.target.value||'a').toLowerCase();
            setSlide(val);
        });
    })();
    </script>
</body>
</html>
