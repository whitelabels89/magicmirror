<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Edu Portal ‚Äî 9 Worlds</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/elearn/worlds/styles.css">
</head>
<body class="portal-body">
  <header class="portal-header">
    <h1>üåç Choose Your World</h1>
    <p>Pilih dunia belajar kamu. Progres & badge akan tersimpan otomatis.</p>
  </header>

  <main class="portal-grid" id="worldGrid"></main>

  <script>
    async function loadWorlds(){
      const res = await fetch('/elearn/worlds/worlds.json');
      const data = await res.json();
      const grid = document.getElementById('worldGrid');
      grid.innerHTML = data.worlds.map(w=>`
        <article class="portal-card" data-entry="${w.entry}">
          <div class="portal-cover" style="background-image:url('${w.cover || "/elearn/img/map/worldmap3.webp"}')"></div>
          <div class="portal-meta">
            <h3>${w.name}</h3>
            <div class="portal-progress" data-world="${w.id}">
              <span class="ring" title="progress"></span>
              <small>loading...</small>
            </div>
          </div>
        </article>
      `).join('');

      // klik kartu
      grid.querySelectorAll('.portal-card').forEach(card=>{
        card.addEventListener('click', ()=>{
          const entry = card.dataset.entry;
          if (entry) window.location = entry;
        });
      });

      // progress (dummy localStorage; bisa ganti Firestore)
      grid.querySelectorAll('.portal-progress').forEach(el=>{
        const key = `progress:${el.dataset.world}`;
        const raw = localStorage.getItem(key);
        const pct = raw ? JSON.parse(raw).percent||0 : 0;
        el.querySelector('small').textContent = `${pct}%`;
        el.querySelector('.ring').style.setProperty('--pct', pct);
      });
    }
    loadWorlds();
  </script>
</body>
</html>
