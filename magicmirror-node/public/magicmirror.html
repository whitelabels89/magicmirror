<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QC Face Consultant</title>
    <link href="https://fonts.googleapis.com/css2?family=Forum&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <style>
        

        .navbar-menu.open {
            display: flex;
        }
        body {
            margin: 0;
            background: #1e3d3a;
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-y: auto;
            color: #333;
        }

        #container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 30px;
        }

        h1 {
            color: #00b4d8;
            margin-bottom: 20px;
        }

        #status {
            margin-bottom: 20px;
            font-size: 1.2rem;
            font-weight: 600;
            color: #06d6a0;
            text-shadow: 0 0 6px #06d6a080;
        }

        #photo {
            width: 280px;
            height: auto;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            background: #fff;
            padding: 10px;
        }

        #recommendation {
            max-width: 85%;
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            color: #333;
            display: none;
        }

        #recommendation h2 {
            color: #ff6b6b;
            margin-bottom: 10px;
        }

        #capture-button {
            background: linear-gradient(to right, #00b4d8, #0077b6);
            color: white;
            border: none;
            padding: 16px 36px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(0, 119, 182, 0.4);
            transition: all 0.3s ease;
        }

        #capture-button:hover {
            background: #0096c7;
            box-shadow: 0 10px 25px rgba(0, 119, 182, 0.5);
            transform: translateY(-3px);
        }

        #gallery {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 30px;
            margin-bottom: 40px;
            gap: 15px;
        }

        #gallery img {
            width: 120px;
            height: auto;
            border-radius: 12px;
            background: #ffffffcc;
            padding: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s ease;
        }

        #gallery img:hover {
            transform: scale(1.05);
        }
        .loading {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #00ff99;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            margin-top: 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .fade-in {
            animation: fadeIn 1s ease forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .fade-in-stagger {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInStagger 0.6s ease-out forwards;
        }

        @keyframes fadeInStagger {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            #photo {
                width: 90%;
            }
            #gallery img {
                width: 90px;
                margin: 8px;
            }
            #capture-button {
                padding: 14px 28px;
                font-size: 1.1rem;
            }
        }

        .gallery-card {
            background: #ffffffcc;
            padding: 10px;
            margin: 8px;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .gallery-card:hover {
            transform: scale(1.08);
            box-shadow: 0 8px 25px rgba(0, 180, 216, 0.6);
            background: #f0faff;
        }

        .gallery-card img {
            width: 120px;
            height: auto;
            border-radius: 12px;
            display: block;
            transition: transform 0.3s ease;
        }

        @media (max-width: 480px) {
            body {
                font-size: 14px;
            }
            #status {
                font-size: 1rem;
            }
            #capture-button {
                width: 80%;
                font-size: 1rem;
                padding: 14px;
            }
            #gallery {
                gap: 8px;
            }
        }

        header nav a:hover {
            color: #ffdd57;
        }

        header {
            position: sticky;
            top: 0;
            z-index: 999;
        }

        header nav a {
            scroll-behavior: smooth;
        }
    </style>
</head>
<body>
    <div id="navbar"></div>
    <script>
        fetch('navbar.html')
          .then(res => res.text())
          .then(data => {
            document.getElementById('navbar').innerHTML = data;
          })
          .then(() => {
            const toggleBtn = document.querySelector('.navbar-toggle');
            const menu = document.querySelector('.navbar-menu');
            if (toggleBtn && menu) {
              toggleBtn.addEventListener('click', () => {
                menu.classList.toggle('show');
              });
            }
          });
    </script>
    <script>
    function bindDropdowns() {
      const toggle = document.getElementById('dropdownToggle');
      const menu = document.getElementById('dropdownMenu');
      const toggle2 = document.getElementById('dropdownToggleEcourse');
      const menu2 = document.getElementById('dropdownMenuEcourse');

      if (toggle && menu && !toggle.dataset.bound) {
        toggle.dataset.bound = true;
        toggle.addEventListener('click', function (e) {
          e.preventDefault();
          menu.style.display = (menu.style.display === 'block') ? 'none' : 'block';
        });
        document.addEventListener('click', function (e) {
          if (!toggle.contains(e.target) && !menu.contains(e.target)) {
            menu.style.display = 'none';
          }
        });
      }

      if (toggle2 && menu2 && !toggle2.dataset.bound) {
        toggle2.dataset.bound = true;
        toggle2.addEventListener('click', function (e) {
          e.preventDefault();
          menu2.style.display = (menu2.style.display === 'block') ? 'none' : 'block';
        });
        document.addEventListener('click', function (e) {
          if (!toggle2.contains(e.target) && !menu2.contains(e.target)) {
            menu2.style.display = 'none';
          }
        });
      }
    }

    // Try to bind dropdowns every 200ms until successful
    let tries = 0;
    const dropdownInterval = setInterval(() => {
      const found = document.getElementById('dropdownToggle') && document.getElementById('dropdownToggleEcourse');
      if (found || tries > 20) {
        clearInterval(dropdownInterval);
        bindDropdowns();
      }
      tries++;
    }, 200);
    </script>
    <section id="greetings" style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px 20px 40px 20px; background: #1e3d3a; text-align: center;">
        <div style="background: #243f3d; border-radius: 30px; padding: 50px 30px; max-width: 1000px; width: 90%; box-shadow: 0 8px 24px rgba(0,0,0,0.2); display: flex; flex-direction: row; align-items: center; justify-content: space-between; gap: 40px; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 280px; text-align: left;">
                <h1 style="font-size: 3rem; color: #ffd700; margin-bottom: 20px; font-family: 'Forum', cursive;">Your Personal AI Beauty Stylist Awaits</h1>
                <p style="max-width: 680px; font-size: 1.2rem; color: #e0e0e0; line-height: 1.6;">Temui Stylist Pribadimu hari ini! QC Magic Mirror menghadirkan konsultasi kecantikan berbasis AI yang personal, ramah, dan dirancang khusus untuk menemukan gaya terbaikmu. Dapatkan pengalaman premium seolah memiliki konsultan kecantikan pribadi di tiap kunjunganmu.</p>
            </div>
            <div style="display: flex; flex-direction: column; align-items: center;">
                <img src="/eve_stylist.png" alt="Eve AI Stylist" style="width: 140px; margin-bottom: 20px; border-radius: 50%; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                <div id="chat-bubble" style="background: #ffffffcc; color: #333; padding: 10px 18px; border-radius: 20px; margin-bottom: 20px; font-size: 1rem; max-width: 320px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); opacity: 0; visibility: hidden; transition: opacity 1s ease;">
                    Hello! Welcome to your personal beauty journey with QC Magic Mirror âœ¨
                </div>
            </div>
        </div>
    </section>
    <div id="form-section" style="display: flex; justify-content: center; align-items: center; min-height: 100vh;">
        <div id="user-info-form" style="background: #ffffffcc; padding: 20px; border-radius: 15px; max-width: 400px; text-align: left;">
            <h2 style="color: #333;">Isi Data Sebelum Analisa</h2>
            <label for="visitor-name">Nama:</label>
            <input type="text" id="visitor-name" style="width: 100%; padding: 8px; margin-bottom: 12px; border-radius: 6px; border: 1px solid #ccc;"><br>
            <label for="visitor-wa">Nomor WhatsApp:</label>
            <input type="text" id="visitor-wa" placeholder="628xxxx" style="width: 100%; padding: 8px; margin-bottom: 12px; border-radius: 6px; border: 1px solid #ccc;"><br>
            <button onclick="submitVisitorInfo()" style="background: #00b4d8; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold;">Lanjutkan</button>
        </div>
    </div>
    <div id="container">
        <div id="camera-wrapper" style="position: relative; width: 380px; max-width: 90%; margin-bottom: 24px; border-radius: 20px; overflow: hidden; box-shadow: 0 8px 24px rgba(0,0,0,0.3); background: #ffffff;">
            <img id="camera-placeholder" src="/magic_mirror.png" style="width: 100%; display: block;">
            <video id="camera-preview" autoplay playsinline muted style="width: 100%; display: none;"></video>
        </div>
        <button id="toggle-camera-button" style="margin-top: 10px; background: linear-gradient(to right, #00b4d8, #0077b6); color: white; border: none; padding: 10px 24px; font-size: 1rem; border-radius: 30px; cursor: pointer; box-shadow: 0 6px 18px rgba(0, 119, 182, 0.4);">Turn On Magic Mirror</button>
        <h1>QC MAGIC MIRROR</h1>
        <button id="capture-button" style="margin-top: 20px;">
            Click to Analyze
        </button>
        <div id="status">Waiting Analyze...</div>
        <img id="photo" src="" style="display:none; max-width: 300px; margin-top: 20px;" />
        <div id="recommendation" style="display:none;">
            <div id="countdown-timer" style="font-size: 1rem; color: #ffdd57; margin-top: 12px;"></div>
            <div id="visual-loading" class="loading" style="display: none;"></div>
            <h2>Rekomendasi Gaya Rambut</h2>
            <p id="rec-content"></p>
        </div>
        <div id="waiting-replicate" style="display:none; font-size: 1rem; color: #ffdd57; margin-top: 10px;">
          âœ¨ Sedang memproses visualisasi gaya rambut AI... Harap tunggu hasilnya tampil di bawah, Estimasi 2 menit.
        </div>
        <div id="loading" class="loading" style="display: none;"></div>
        <div id="gallery" style="display: flex; flex-wrap: wrap; justify-content: center; margin-top: 20px;"></div>
    </div>
    <div id="footer-placeholder"></div>
    <script>
      fetch('/footer.html')
        .then(res => res.text())
        .then(data => document.getElementById('footer-placeholder').innerHTML = data);
    </script>

    <div id="lightbox" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); backdrop-filter: blur(8px); justify-content:center; align-items:center; z-index:9999;">
        <img id="lightbox-img" src="" style="max-width:90%; max-height:90%; border-radius:12px;">
    </div>

    <script>
    window.addEventListener('DOMContentLoaded', () => {
        const video = document.getElementById('camera-preview');
        const placeholder = document.getElementById('camera-placeholder');
        const toggleBtn = document.getElementById('toggle-camera-button');
        let stream = null;

        function startCamera() {
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } })
                .then(function(s) {
                    stream = s;
                    const video = document.getElementById('camera-preview');
                    const placeholder = document.getElementById('camera-placeholder');
                    video.srcObject = stream;
                    video.style.display = 'block';
                    placeholder.style.display = 'none';
                    toggleBtn.innerText = "Turn Off Magic Mirror";
                    updateCaptureButton();
                })
                .catch(function(error) {
                    console.error('ðŸš« Tidak bisa mengakses kamera:', error.name, error.message);
                    alert('âš ï¸ Kamera tidak dapat diakses. Pastikan kamu memberi izin di browser.');
                });
            }
        }

        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            const video = document.getElementById('camera-preview');
            const placeholder = document.getElementById('camera-placeholder');
            video.style.display = 'none';
            placeholder.style.display = 'block';
            toggleBtn.innerText = "Turn On Magic Mirror";
            updateCaptureButton();
        }

        // Set initial button text to "Turn On Camera" (redundant if set in HTML, but ensures correct state)
        toggleBtn.innerText = "Turn On Magic Mirror";

        toggleBtn.addEventListener('click', () => {
            if (stream) {
                stopCamera();
            } else {
                startCamera();
            }
        });

        // Camera will NOT start automatically on page load.
        // startCamera(); // Removed to prevent auto-start
        updateCaptureButton();
    });
    </script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const sessionId = `${Date.now()}_${Math.floor(Math.random() * 100000)}`;
        const socket = io('https://queensacademy.id');
        let connected = false;
        // stream will be set by camera script, but for safety, we check window.stream too
        function getStream() {
            return typeof stream !== 'undefined' ? stream : window.stream;
        }
        const captureBtn = document.getElementById('capture-button');
        function setStatus(msg, color) {
            const status = document.getElementById('status');
            status.innerText = msg;
            if (color) status.style.color = color;
            else status.style.color = '#00ff99';
        }
        function updateCaptureButton() {
            const userInfoForm = document.getElementById('user-info-form');
            const name = localStorage.getItem('visitor_name');
            const wa = localStorage.getItem('visitor_wa');
            if (connected && name && wa && (!userInfoForm || userInfoForm.style.display === 'none')) {
                captureBtn.disabled = false;
                captureBtn.style.opacity = '1';
                captureBtn.style.cursor = 'pointer';
            } else {
                captureBtn.disabled = true;
                captureBtn.style.opacity = '0.5';
                captureBtn.style.cursor = 'not-allowed';
            }
        }
        document.getElementById('capture-button').addEventListener('click', () => {
            console.log("ðŸ“¦ Mengirim foto dengan sessionId:", sessionId);
            console.log("ðŸ“¦ visitor_name:", localStorage.getItem('visitor_name'));
            console.log("ðŸ“¦ visitor_wa:", localStorage.getItem('visitor_wa'));
            const video = document.getElementById('camera-preview');
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth || 640;
            canvas.height = video.videoHeight || 480;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

            const base64Photo = canvas.toDataURL('image/jpeg').replace(/^data:image\/jpeg;base64,/, '');

            setStatus('ðŸ” Menganalisis wajah...', '#fff700');
            document.getElementById('loading').style.display = 'block';
            // âœ… Spinner awal rekomendasi tetap dipertahankan
            document.getElementById('recommendation').style.display = 'none';
            document.getElementById('gallery').innerHTML = '';
            document.getElementById('waiting-replicate').style.display = 'none';

            const startTimestamp = Math.floor(Date.now() / 1000);
            console.log("ðŸ“¤ Mengirim foto ke backend... start_timestamp:", startTimestamp);
            if (!sessionId || !localStorage.getItem('visitor_name') || !localStorage.getItem('visitor_wa')) {
                alert("Gagal: Data belum lengkap. Silakan isi nama dan WA terlebih dahulu.");
                setStatus("âŒ Gagal: Data pengunjung tidak lengkap.", "red");
                return;
            }
            fetch('https://qc-magicmirror-api.onrender.com/run', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    photo: base64Photo,
                    session_id: sessionId,
                    visitor_name: localStorage.getItem('visitor_name') || '',
                    visitor_wa: localStorage.getItem('visitor_wa') || ''
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('âœ… Respon AI:', data);
                if (data.status === 'pending') {
                    console.log("ðŸ•’ Status pending diterima. start_timestamp:", data.start_timestamp || 'N/A');
                }

                if (data.status === 'done') {
                    document.getElementById('rec-content').innerText = data.recommendation || 'Tidak ada rekomendasi.';
                    document.getElementById('recommendation').style.display = 'block';
                    setStatus('âœ… Rekomendasi siap!', '#00ff99');

                    if (data.faces && data.faces.length > 0) {
                        const gallery = document.getElementById('gallery');
                        data.faces.forEach((url, index) => {
                            const card = document.createElement('div');
                            card.className = 'gallery-card fade-in-stagger';
                            card.style.animationDelay = `${index * 0.2}s`;
                            const img = document.createElement('img');
                            img.src = url.startsWith('http') ? url : `https://qc-magicmirror-api.onrender.com${url}`;
                            card.appendChild(img);
                            gallery.appendChild(card);
                        });
                        setTimeout(() => {
                            gallery.scrollIntoView({ behavior: 'smooth' });
                        }, 300);
                    }
                    // â¬‡ï¸ Pindahkan waiting-replicate di sini, setelah recommendation tampil
                    document.getElementById('waiting-replicate').style.display = 'block';
                } else {
                    setStatus('âš ï¸ Gagal: ' + (data.error || 'Tidak terdeteksi wajah.'), 'orange');
                }
            })
            .catch(err => {
                console.error('âŒ Error fetch:', err);
                setStatus('âŒ Gagal mengirim ke server.', 'red');
            })
            .finally(() => {
                document.getElementById('loading').style.display = 'none';
            });
        });

        socket.on('connect', () => {
            connected = true;
            // Jika form user info masih ada, status tetap minta isi data
            const userInfoForm = document.getElementById('user-info-form');
            if (userInfoForm && userInfoForm.style.display !== 'none') {
                setStatus("ðŸ”’ Isi nama dan WhatsApp terlebih dahulu", '#ffdd57');
            } else {
                setStatus('Standby, Turn on Magic Mirror', '#00ff99');
            }
            document.getElementById('loading').style.display = 'none';
            updateCaptureButton();
            socket.emit('join', { session_id: sessionId });
            console.log("ðŸ” Session ID dikirim ke server:", sessionId);
        });
        socket.on('ai_result', (data) => {
            console.log('ðŸ§  Rekomendasi AI diterima.');
            const recommendation = document.getElementById('recommendation');
            const recContent = document.getElementById('rec-content');
            recContent.innerText = data.recommendationText || data.recommendation;
            recommendation.style.display = 'block';
            recommendation.classList.add('fade-in');
            document.getElementById('loading').style.display = 'none';
            setStatus('âœ… Recommendation', '#00ff99');
            document.getElementById('waiting-replicate').style.display = 'block';
        });
socket.on('generated_faces', (data) => {
    if (data.session_id && data.session_id !== sessionId) return; // â›” Abaikan jika bukan untuk sesi ini
    console.log('ðŸ–¼ï¸ Generated faces diterima.');
    console.log("â³ start_timestamp:", data.start_timestamp);
    const gallery = document.getElementById('gallery');
    const statusEl = document.getElementById('status');
    const loadingEl = document.getElementById('loading');
    const waitingEl = document.getElementById('waiting-replicate');

    const validFaces = (data.faces || []).filter(url => url && url.trim() !== '');

    // âœ… Tampilkan pesan status dari backend
    if (data.message) {
        statusEl.innerText = data.message;
        statusEl.style.color = '#ffdd57';
    }

    // â³ Countdown dan spinner hanya saat status === 'pending'
    if (data.status === 'pending' && data.start_timestamp && validFaces.length === 0) {
        const countdownTarget = data.start_timestamp + 120;
        waitingEl.style.display = 'block';
        document.getElementById('visual-loading').style.display = 'block';

        let interval = null;
        const updateCountdown = () => {
            const now = Math.floor(Date.now() / 1000);
            const remaining = countdownTarget - now;
            if (remaining <= 0) {
                waitingEl.innerText = "â³ Hampir selesai... harap tunggu.";
                loadingEl.style.display = 'none';
                document.getElementById('visual-loading').style.display = 'none';
                document.getElementById('countdown-timer').innerText = '';
                // Do not hide waitingEl yet, let it display the message
                clearInterval(interval);
            } else {
                document.getElementById('countdown-timer').innerText = `âœ¨ Visualisasi akan tampil dalam ${remaining} detik...`;
            }
        };
        updateCountdown();
        interval = setInterval(updateCountdown, 1000);

        // âœ… Spinner awal rekomendasi tetap dipertahankan
        loadingEl.style.display = 'block';
        // Do NOT hide loadingEl or waitingEl here; only after countdown ends or faces shown
    }

    // ðŸŽ¨ Kalau ada hasil wajah, tampilkan ke galeri
    if (validFaces.length > 0) {
        gallery.innerHTML = '';
        validFaces.forEach((url, index) => {
            const card = document.createElement('div');
            card.className = 'gallery-card fade-in-stagger';
            card.style.animationDelay = `${index * 0.2}s`;
            const img = document.createElement('img');
            img.src = url;
            card.appendChild(img);
            gallery.appendChild(card);
        });
        setTimeout(() => {
            gallery.scrollIntoView({ behavior: 'smooth' });
        }, 300);
        loadingEl.style.display = 'none';
        waitingEl.style.display = 'none';
        document.getElementById('visual-loading').style.display = 'none';
        document.getElementById('countdown-timer').innerText = '';
    }
});


        // Lightbox for gallery images
        document.getElementById('gallery').addEventListener('click', (e) => {
            if (e.target.tagName === 'IMG') {
                document.getElementById('lightbox-img').src = e.target.src;
                document.getElementById('lightbox').style.display = 'flex';
            }
        });

        document.getElementById('lightbox').addEventListener('click', () => {
            document.getElementById('lightbox').style.display = 'none';
        });
        socket.on('session_limit_reached', (data) => {
            alert(data.message || "Sistem sedang penuh. Coba lagi sebentar lagi.");
            setStatus("ðŸš« Sistem sedang penuh. Coba beberapa saat lagi.", "orange");
            document.getElementById('user-info-form').style.display = 'block';
            document.getElementById('capture-button').disabled = true;
            document.getElementById('capture-button').style.opacity = '0.5';
            document.getElementById('capture-button').style.cursor = 'not-allowed';
        });
        socket.on('disconnect', () => {
            connected = false;
            setStatus('âš¡ Koneksi terputus. Klik Turn On Magic Mirror lagi jika diperlukan.', 'red');
            document.getElementById('loading').style.display = 'none';
            updateCaptureButton();
        });

        // When camera toggled, update the button too
        document.getElementById('toggle-camera-button').addEventListener('click', () => {
            setTimeout(updateCaptureButton, 500); // slight delay to ensure stream state updated
        });

        // --- Visitor Info Logic ---
        function submitVisitorInfo() {
            const name = document.getElementById('visitor-name').value.trim();
            const wa = document.getElementById('visitor-wa').value.trim();

            if (!name || !wa) {
                alert("Nama dan Nomor WhatsApp wajib diisi.");
                return;
            }
            if (!sessionId || !connected) {
                alert("Koneksi ke server belum siap. Silakan tunggu sebentar dan coba lagi.");
                return;
            }

            console.log("âœ… Data form disubmit:", name, wa); // Tambahkan log ini

            // Simpan info ke localStorage untuk keperluan lain jika dibutuhkan
            localStorage.setItem('visitor_name', name);
            localStorage.setItem('visitor_wa', wa);
            console.log("ðŸ“¦ visitor_name saved:", localStorage.getItem('visitor_name'));
            console.log("ðŸ“¦ visitor_wa saved:", localStorage.getItem('visitor_wa'));

            console.log("ðŸ“¨ Kirim ke backend:", sessionId, name, wa);

            // Kirim ke backend via socket
            socket.emit("user_info", {
                name: name,
                wa: wa,
                session_id: sessionId
            });

            // Sembunyikan form, aktifkan tombol
            document.getElementById('user-info-form').style.display = 'none';
            setStatus("âœ… Siap analisa!", '#00ff99');
            updateCaptureButton();
            showPopupMessage();
            console.log("ðŸ“¦ Session ID at submit:", sessionId);
        }

</script>
<script>
function showPopupMessage() {
    const popup = document.getElementById('popup-message');
    popup.style.display = 'block';
    setTimeout(() => {
        popup.style.display = 'none';
    }, 5000);
}
</script>
<script>
// Cegah user klik analyze sebelum isi data
window.addEventListener('DOMContentLoaded', () => {
    document.getElementById('capture-button').disabled = true;
    document.getElementById('capture-button').style.opacity = '0.5';
    document.getElementById('status').innerText = "ðŸ”’ Isi nama dan WhatsApp terlebih dahulu";
});
    </script>
    <div id="popup-message" style="display: none; position: fixed; top: 20px; right: 20px; background-color: #00b4d8; color: white; padding: 12px 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 9999; font-weight: 600;">
      Data berhasil disimpan. Klik tombol di bawah untuk mulai analisa!
    </div>
</body>
<script>
window.addEventListener('DOMContentLoaded', () => {
    const bubble = document.getElementById('chat-bubble');
    bubble.style.visibility = 'hidden';
    setTimeout(() => {
        bubble.style.visibility = 'visible';
        bubble.style.opacity = '1';
    }, 1000);
});
</script>
</html>